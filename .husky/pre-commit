#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# æ£€æŸ¥æ˜¯å¦æœ‰ TypeScript é”™è¯¯ï¼ˆæš‚æ—¶è·³è¿‡ï¼Œå› ä¸ºæœ‰ä¸€äº›ç±»å‹é—®é¢˜éœ€è¦ä¿®å¤ï¼‰
# echo "ğŸ“ Checking TypeScript..."
# cd backend && npm run build --if-present
# cd ../frontend && npm run build --if-present

# æ£€æŸ¥æ˜¯å¦æäº¤äº†æ•æ„Ÿæ–‡ä»¶
echo "ğŸ” Checking for sensitive files..."
if git diff --cached --name-only | grep -E '\.env$|\.env\.local$|\.env\.production$'; then
  echo "âŒ Error: Attempting to commit .env file!"
  echo "Please remove .env files from commit"
  exit 1
fi

# æ£€æŸ¥æ˜¯å¦æœ‰è¶…å¤§æ–‡ä»¶
echo "ğŸ“¦ Checking file sizes..."
git diff --cached --name-only | while read file; do
  if [ -f "$file" ]; then
    size=$(wc -c < "$file")
    if [ $size -gt 5242880 ]; then  # 5MB
      echo "âŒ Error: File $file is larger than 5MB"
      exit 1
    fi
  fi
done

echo "âœ… Pre-commit checks passed!"

