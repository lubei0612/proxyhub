# 静态住宅选购 - 待修复问题

## 已完成优化 ✅

### UI重构（2025-11-03）
- ✅ IP类型改为大卡片样式（普通+原生）
- ✅ 时长选择改为水平按钮组，去掉具体金额
- ✅ 支付面板改为985proxy风格
- ✅ 地区选择按钮优化

## 待修复问题 ⚠️

### 1. 购物车逻辑问题
**问题描述：**
- 点击国家卡片的"增加IP数量"按钮后，右侧支付面板仍然显示"请先选择IP"
- 数量增加后，支付面板应该显示支付详情

**可能原因：**
1. `updateSelection()` 方法未正确触发
2. `totalSelectedCount` 计算有误
3. `selectedCountries` 数组未更新

**解决方案：**
检查 `StaticBuy.vue` 中的：
- `item.quantity` 绑定
- `updateSelection()` 方法实现
- `totalSelectedCount` 计算逻辑
- `selectedCountries` 过滤条件

### 2. 价格计算逻辑
**需求：**
- 不同国家的原生IP价格可能不同
- 需要从后端API获取每个国家的具体价格
- 前端根据选择的IP数量、时长、国家动态计算总价

**API设计建议：**
```typescript
GET /api/v1/pricing/static-proxy
Query: {
  ipType: 'shared' | 'premium',
  countryCode: string,
  cityName: string
}
Response: {
  basePrice: number, // 30天基础价格
  priceOverrides: { // 特定国家覆盖价格
    [countryCode]: number
  }
}
```

### 3. 管理后台价格管理
**需求：**
用户希望管理后台使用商品卡形式，方便修改价格。

**设计方案：**
- 展示所有国家的IP商品卡（类似985proxy）
- 每个卡片显示：国家、城市、当前价格（普通/原生）
- 点击可编辑价格
- 支持批量设置区域价格

## 测试清单

### 功能测试
- [ ] 选择IP类型（普通/原生），价格自动更新
- [ ] 选择时长（30/60/90/180/360天），总价自动计算
- [ ] 选择国家/城市，增加数量
- [ ] 右侧支付面板正确显示选中的IP信息
- [ ] 总计费用正确计算
- [ ] 钱包余额支付按钮可用
- [ ] 购买成功后跳转到订单页面

### UI测试
- [ ] IP类型卡片hover效果
- [ ] 选中状态的高亮显示
- [ ] 时长按钮的active状态
- [ ] 支付面板的响应式布局
- [ ] 国家卡片的4列网格布局

## 下一步计划

1. **立即修复：** 购物车逻辑问题（让选择IP功能正常工作）
2. **后端开发：** 价格API接口
3. **管理后台：** 价格管理页面（国家卡片式）
4. **完整测试：** 使用Chrome DevTools进行端到端测试

---

**更新时间：** 2025-11-03 12:25 UTC+8
**负责人：** AI Assistant
**状态：** 进行中

