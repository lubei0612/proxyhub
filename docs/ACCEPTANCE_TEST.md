# ProxyHub 验收测试方案

## 测试环境要求
- Node.js v18+
- PostgreSQL 数据库（已通过Docker启动）
- Chrome浏览器（用于DevTools调试）

## 启动服务

### 方法1：使用一键启动脚本（推荐）
```bash
.\启动ProxyHub.bat
```

### 方法2：手动分步启动
```bash
# 1. 启动数据库（如果未启动）
docker-compose up -d postgres

# 2. 启动后端（在backend目录）
cd backend
npm run start:dev

# 3. 启动前端（在frontend目录，新终端）
cd frontend
npm run dev
```

## 服务访问地址
- **前端**: http://localhost:8080
- **后端API**: http://localhost:3000
- **API文档**: http://localhost:3000/api
- **数据库**: localhost:5432

## 功能验收清单

### 1. 用户认证模块 ✅

#### 1.1 用户注册
**测试步骤**：
1. 访问 http://localhost:8080/register
2. 输入邮箱、密码
3. 点击"注册"按钮

**预期结果**：
- 注册成功后自动跳转到仪表盘
- 新用户初始余额为 $0.00

**测试账号**：
- 邮箱：test@test.com
- 密码：test123456

#### 1.2 用户登录
**测试步骤**：
1. 访问 http://localhost:8080/login
2. 输入邮箱和密码
3. 点击"登录"按钮

**预期结果**：
- 登录成功跳转到仪表盘
- 顶部显示用户邮箱和余额

**测试账号**：
- 普通用户：user@example.com / password123
- 管理员：admin@example.com / admin123

#### 1.3 管理员登录
**测试步骤**：
1. 使用管理员账号登录
2. 点击右上角用户菜单
3. 选择"管理后台"

**预期结果**：
- 跳转到 /admin/dashboard
- 显示管理后台界面

---

### 2. 仪表盘模块 ✅

#### 2.1 仪表盘数据展示
**测试步骤**：
1. 登录后自动进入仪表盘
2. 查看数据统计

**预期结果**：
- 显示用户信息（邮箱、昵称、余额）
- 显示代理统计（总数、活跃、过期）
- 显示订单统计（总数、已完成）
- 显示消费统计（总消费金额）

**Chrome DevTools检查**：
- Network标签：查看 /api/v1/dashboard/overview 请求
- Response应返回完整的用户和统计数据

---

### 3. 静态代理模块 ✅

#### 3.1 静态代理选购
**测试步骤**：
1. 点击侧边栏"静态住宅" → "静态住宅选购"
2. 选择国家/城市（如：US/New York）
3. 选择IP类型（普通/原生）
4. 选择时长（30/60/90天）
5. 输入数量
6. 点击"购买"

**预期结果**：
- 显示总价格计算
- 购买成功后弹出成功提示
- 余额扣减
- 代理列表中出现新购买的IP

**Chrome DevTools检查**：
- Network：/api/v1/proxy/static/purchase (POST)
- Payload：检查发送的购买参数
- Response：返回订单号、分配的IP列表

#### 3.2 静态代理管理
**测试步骤**：
1. 点击"静态住宅管理"
2. 查看已购买的代理列表
3. 测试筛选功能（按国家、状态）
4. 测试导出功能（CSV/TXT）

**预期结果**：
- 显示IP、端口、账号、密码、国家、到期时间
- 筛选功能正常
- 导出文件格式正确

---

### 4. 钱包充值模块 ✅

#### 4.1 提交充值申请
**测试步骤**：
1. 点击"钱包充值"
2. 输入充值金额（如100）
3. 选择支付方式（支付宝/微信/银行转账）
4. 填写备注
5. 点击"提交充值"

**预期结果**：
- 提交成功后显示"充值申请已提交"
- 充值记录显示状态为"待审核"

**Chrome DevTools检查**：
- Network：/api/v1/billing/recharge (POST)
- Response：返回充值订单信息

#### 4.2 查看充值记录
**测试步骤**：
1. 在充值页面查看历史记录
2. 查看状态（待审核/已批准/已拒绝）

**预期结果**：
- 显示充值金额、方式、状态、时间

---

### 5. 订单管理模块 ✅

#### 5.1 查看订单列表
**测试步骤**：
1. 点击"账单明细" → "订单管理"
2. 查看所有订单

**预期结果**：
- 显示订单号、类型、金额、状态、创建时间
- 支持分页

---

### 6. 交易记录模块 ✅

#### 6.1 查看交易明细
**测试步骤**：
1. 点击"账单明细" → "交易明细"
2. 查看所有交易记录

**预期结果**：
- 显示交易号、类型、金额、余额变化、时间
- 类型包括：充值、购买、退款等

---

### 7. 账户中心模块 ✅

#### 7.1 个人信息管理
**测试步骤**：
1. 点击"我的账户" → "账户中心"
2. 修改昵称
3. 保存

**预期结果**：
- 保存成功提示
- 信息更新

#### 7.2 修改密码
**测试步骤**：
1. 输入旧密码
2. 输入新密码
3. 确认新密码
4. 点击"修改密码"

**预期结果**：
- 修改成功提示
- 下次登录使用新密码

#### 7.3 API密钥管理
**测试步骤**：
1. 点击"生成API密钥"
2. 复制密钥

**预期结果**：
- 显示新生成的API密钥
- 支持重置

---

### 8. 管理后台模块 ✅

#### 8.1 管理员登录
**测试账号**：
- 邮箱：admin@example.com
- 密码：admin123

#### 8.2 用户管理
**测试步骤**：
1. 进入管理后台
2. 点击"用户管理"
3. 查看所有用户列表
4. 修改用户状态（激活/禁用）
5. 修改用户角色

**预期结果**：
- 显示所有用户信息
- 支持状态和角色修改

#### 8.3 充值审核
**测试步骤**：
1. 点击"充值审核"
2. 查看待审核的充值申请
3. 批准充值申请

**预期结果**：
- 批准后用户余额增加
- 状态变为"已批准"
- 生成交易记录

**Chrome DevTools检查**：
- Network：/api/v1/billing/recharge/:id/approve (PUT)
- Response：确认余额更新

#### 8.4 订单管理
**测试步骤**：
1. 点击"订单管理"
2. 查看所有订单

**预期结果**：
- 显示所有用户的订单
- 支持筛选和搜索

#### 8.5 系统统计
**测试步骤**：
1. 点击"仪表盘"
2. 查看系统统计数据

**预期结果**：
- 显示总用户数
- 显示总代理数
- 显示总订单数
- 显示总充值金额

---

## Chrome DevTools调试指南

### Network面板调试
1. 打开Chrome DevTools（F12）
2. 切换到Network标签
3. 执行操作（如登录、购买代理）
4. 检查请求和响应：
   - Request Headers：查看Authorization（JWT token）
   - Request Payload：查看发送的数据
   - Response：查看返回的数据和状态码

**常见API端点**：
- POST /api/v1/auth/login - 登录
- POST /api/v1/auth/register - 注册
- GET /api/v1/dashboard/overview - 仪表盘数据
- POST /api/v1/proxy/static/purchase - 购买静态代理
- POST /api/v1/billing/recharge - 提交充值
- GET /api/v1/orders - 查看订单

### Console面板调试
1. 切换到Console标签
2. 查看前端日志和错误信息
3. 检查是否有JavaScript错误

### 常见问题排查

#### 问题1：API请求401 Unauthorized
**原因**：JWT token过期或无效
**解决**：重新登录

#### 问题2：API请求404 Not Found
**原因**：后端服务未启动或路由配置错误
**解决**：
1. 检查后端服务是否运行（http://localhost:3000）
2. 查看后端日志

#### 问题3：页面空白
**原因**：前端服务未启动或编译错误
**解决**：
1. 检查前端服务（http://localhost:8080）
2. 查看浏览器Console是否有错误
3. 查看终端中的Vite编译日志

#### 问题4：数据库连接失败
**原因**：PostgreSQL服务未启动
**解决**：
```bash
docker-compose up -d postgres
```

---

## 测试数据

### 预置用户
| 角色 | 邮箱 | 密码 | 初始余额 |
|------|------|------|---------|
| 管理员 | admin@example.com | admin123 | $10000.00 |
| 普通用户 | user@example.com | password123 | $1000.00 |

### 测试IP购买参数
```json
{
  "channelName": "住宅代理",
  "ipType": "normal",
  "duration": 30,
  "scenario": "测试",
  "items": [
    {
      "country": "US",
      "city": "New York",
      "quantity": 2
    }
  ]
}
```

---

## 验收标准

### 必须通过的测试
- ✅ 用户注册和登录
- ✅ 仪表盘数据正确显示
- ✅ 静态代理购买流程完整
- ✅ 余额扣减和交易记录正确
- ✅ 管理员充值审核功能
- ✅ API响应格式符合规范

### 性能要求
- API响应时间 < 500ms
- 页面加载时间 < 2s
- 无明显的UI卡顿

### 安全要求
- JWT token有效期管理
- 密码使用bcrypt加密
- API需要身份验证
- 管理员权限隔离

---

## 已知限制

1. **动态代理模块**：暂未实现，显示"功能开发中"
2. **移动代理模块**：暂未实现，菜单项禁用
3. **985Proxy API集成**：暂时使用Mock数据
4. **实时代理流量统计**：暂未实现
5. **Telegram通知**：暂未实现
6. **前端图表数据**：部分使用Mock数据

---

## 下一步开发计划

1. 集成真实的985Proxy API
2. 实现动态代理模块
3. 完善前端图表数据展示
4. 添加Telegram通知功能
5. 优化Docker生产环境配置
6. 添加单元测试和E2E测试

---

## 技术支持

如有问题，请检查：
1. 后端日志：backend终端输出
2. 前端日志：浏览器Console
3. 数据库日志：`docker-compose logs postgres`
4. API文档：http://localhost:3000/api

**验收日期**：2025年11月2日
**版本**：v1.0.0
**状态**：待验收 ✅

