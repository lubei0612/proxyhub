# ProxyHub è…¾è®¯äº‘éƒ¨ç½²æŒ‡å—

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ5åˆ†é’Ÿä¸Šçº¿ï¼‰

### å‰ç½®è¦æ±‚
- è…¾è®¯äº‘æœåŠ¡å™¨ï¼ˆæ¨èï¼š2æ ¸4Gå†…å­˜ï¼ŒCentOS 7+ æˆ– Ubuntu 20.04+ï¼‰
- å·²å®‰è£… Docker å’Œ Docker Compose
- åŸŸåï¼ˆå¯é€‰ï¼Œå»ºè®®é…ç½®ï¼‰

---

## ğŸ“‹ æ­¥éª¤ 1: å‡†å¤‡æœåŠ¡å™¨

### 1.1 å®‰è£… Docker

**CentOS 7+:**
```bash
# å®‰è£… Docker
sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo yum install -y docker-ce docker-ce-cli containerd.io

# å¯åŠ¨ Docker
sudo systemctl start docker
sudo systemctl enable docker

# å®‰è£… Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

**Ubuntu 20.04+:**
```bash
# æ›´æ–°è½¯ä»¶åŒ…
sudo apt update

# å®‰è£… Docker
sudo apt install -y docker.io docker-compose

# å¯åŠ¨ Docker
sudo systemctl start docker
sudo systemctl enable docker
```

### 1.2 é…ç½®é˜²ç«å¢™

```bash
# å¼€æ”¾å¿…è¦ç«¯å£
sudo firewall-cmd --permanent --add-port=80/tcp    # HTTP
sudo firewall-cmd --permanent --add-port=443/tcp   # HTTPS (å¯é€‰)
sudo firewall-cmd --reload

# æˆ–è€…ä½¿ç”¨ iptables (Ubuntu)
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

---

## ğŸ“¦ æ­¥éª¤ 2: éƒ¨ç½²åº”ç”¨

### 2.1 ä¸Šä¼ ä»£ç 

```bash
# åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•
mkdir -p /opt/proxyhub
cd /opt/proxyhub

# æ–¹æ³• A: ä½¿ç”¨ Gitï¼ˆæ¨èï¼‰
git clone https://github.com/lubei0612/proxyhub.git .

# æ–¹æ³• B: æ‰‹åŠ¨ä¸Šä¼ 
# ä½¿ç”¨ scp æˆ– FTP å·¥å…·ä¸Šä¼ æ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹
```

### 2.2 é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.template .env.production

# ç¼–è¾‘ç¯å¢ƒå˜é‡ï¼ˆéå¸¸é‡è¦ï¼ï¼‰
vim .env.production  # æˆ–ä½¿ç”¨ nano
```

**å¿…é¡»ä¿®æ”¹çš„é…ç½®é¡¹ï¼š**
```bash
# æ•°æ®åº“å¯†ç ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
DATABASE_PASSWORD=your_secure_database_password_here

# JWT å¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ï¼Œè‡³å°‘32ä½ï¼‰
JWT_SECRET=your_jwt_secret_min_32_chars_random_string
JWT_REFRESH_SECRET=your_refresh_secret_min_32_chars_random

# API URLï¼ˆä¿®æ”¹ä¸ºæ‚¨çš„åŸŸåæˆ–IPï¼‰
VITE_API_URL=http://your-server-ip  # æˆ– https://your-domain.com

# ç®¡ç†å‘˜è´¦å·ï¼ˆé¦–æ¬¡éƒ¨ç½²åè¯·ä¿®æ”¹ï¼‰
ADMIN_EMAIL=admin@yourdomain.com
ADMIN_PASSWORD=your_secure_admin_password
```

### 2.3 ä¸€é”®éƒ¨ç½²

```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml --env-file .env.production up -d --build

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps
```

**é¢„æœŸè¾“å‡ºï¼š**
```
NAME                   STATUS              PORTS
proxyhub-backend       Up (healthy)        0.0.0.0:3000->3000/tcp
proxyhub-frontend      Up (healthy)        0.0.0.0:80->80/tcp
proxyhub-postgres      Up (healthy)        0.0.0.0:5432->5432/tcp
proxyhub-redis         Up (healthy)        0.0.0.0:6379->6379/tcp
```

---

## ğŸ“Š æ­¥éª¤ 3: åˆå§‹åŒ–æ•°æ®åº“

```bash
# è¿›å…¥åç«¯å®¹å™¨
docker exec -it proxyhub-backend sh

# è¿è¡Œæ•°æ®åº“è¿ç§»
npm run migration:run

# è¿è¡Œç§å­æ•°æ®ï¼ˆåˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼‰
npm run seed

# é€€å‡ºå®¹å™¨
exit
```

**é»˜è®¤æµ‹è¯•è´¦å·ï¼š**
- **ç®¡ç†å‘˜**: `admin@proxy.com` / `admin123456`
- **æµ‹è¯•ç”¨æˆ·**: `test@test.com` / `test123456`

âš ï¸ **é‡è¦**ï¼šé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹ç®¡ç†å‘˜å¯†ç ï¼

---

## ğŸŒ æ­¥éª¤ 4: è®¿é—®åº”ç”¨

### 4.1 é€šè¿‡ IP è®¿é—®
```
http://your-server-ip
```

### 4.2 é…ç½®åŸŸåï¼ˆå¯é€‰ä½†æ¨èï¼‰

**A. è…¾è®¯äº‘ DNS é…ç½®ï¼š**
1. ç™»å½•è…¾è®¯äº‘ DNSPod
2. æ·»åŠ  A è®°å½•ï¼š`@` æˆ– `www` â†’ æœåŠ¡å™¨ IP
3. ç­‰å¾… DNS è§£æç”Ÿæ•ˆï¼ˆ5-10åˆ†é’Ÿï¼‰

**B. Nginx åå‘ä»£ç†é…ç½®ï¼š**

å¦‚æœæ‚¨æœ‰åŸŸåå¹¶ä¸”æƒ³ä½¿ç”¨ HTTPSï¼Œåˆ›å»º Nginx é…ç½®ï¼š

```bash
# åˆ›å»º Nginx é…ç½®æ–‡ä»¶
sudo vim /etc/nginx/conf.d/proxyhub.conf
```

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

**C. é…ç½® SSL/HTTPSï¼ˆä½¿ç”¨ Certbotï¼‰ï¼š**

```bash
# å®‰è£… Certbot
sudo yum install -y certbot python3-certbot-nginx  # CentOS
# æˆ–
sudo apt install -y certbot python3-certbot-nginx  # Ubuntu

# è·å– SSL è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# é‡å¯ Nginx
sudo systemctl restart nginx
```

---

## ğŸ”§ å¸¸ç”¨è¿ç»´å‘½ä»¤

### æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f backend
docker-compose -f docker-compose.prod.yml logs -f frontend
docker-compose -f docker-compose.prod.yml logs -f postgres
```

### é‡å¯æœåŠ¡
```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose -f docker-compose.prod.yml restart backend
docker-compose -f docker-compose.prod.yml restart frontend
```

### åœæ­¢æœåŠ¡
```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®ï¼ˆå±é™©ï¼ï¼‰
docker-compose -f docker-compose.prod.yml down -v
```

### æ›´æ–°ä»£ç 
```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose -f docker-compose.prod.yml up -d --build
```

### å¤‡ä»½æ•°æ®åº“
```bash
# å¤‡ä»½ PostgreSQL
docker exec proxyhub-postgres pg_dump -U postgres proxyhub > backup_$(date +%Y%m%d_%H%M%S).sql

# æ¢å¤æ•°æ®åº“
cat backup.sql | docker exec -i proxyhub-postgres psql -U postgres proxyhub
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“ä¼˜åŒ–
```bash
# ç¼–è¾‘ PostgreSQL é…ç½®
docker exec -it proxyhub-postgres vim /var/lib/postgresql/data/postgresql.conf

# æ¨èé…ç½®ï¼ˆ2æ ¸4GæœåŠ¡å™¨ï¼‰
shared_buffers = 512MB
effective_cache_size = 1536MB
max_connections = 200
```

### 2. Nginx ç¼“å­˜ä¼˜åŒ–
```nginx
# æ·»åŠ ç¼“å­˜é…ç½®
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=STATIC:10m inactive=7d use_temp_path=off;

location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
    proxy_cache STATIC;
    proxy_cache_valid 200 7d;
    proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
}
```

### 3. ä½¿ç”¨ CDN
- æ¨èï¼šè…¾è®¯äº‘ CDN
- åŠ é€Ÿé™æ€èµ„æºå’Œ API è¯·æ±‚
- é™ä½æœåŠ¡å™¨è´Ÿè½½

---

## ğŸ”’ å®‰å…¨åŠ å›º

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 
```bash
# ç™»å½•åº”ç”¨åç«‹å³ä¿®æ”¹ï¼š
# - ç®¡ç†å‘˜å¯†ç 
# - æ•°æ®åº“å¯†ç 
# - JWT å¯†é’¥
```

### 2. é…ç½®é˜²ç«å¢™è§„åˆ™
```bash
# åªå¼€æ”¾å¿…è¦ç«¯å£
sudo firewall-cmd --permanent --remove-port=3000/tcp  # å…³é—­åç«¯ç›´æ¥è®¿é—®
sudo firewall-cmd --permanent --remove-port=5432/tcp  # å…³é—­æ•°æ®åº“ç›´æ¥è®¿é—®
sudo firewall-cmd --permanent --remove-port=6379/tcp  # å…³é—­ Redis ç›´æ¥è®¿é—®
sudo firewall-cmd --reload
```

### 3. å¯ç”¨ HTTPS
- ä½¿ç”¨ Certbot é…ç½®å…è´¹ SSL è¯ä¹¦
- å¼ºåˆ¶ HTTPS é‡å®šå‘
- å¯ç”¨ HSTS å¤´

### 4. å®šæœŸæ›´æ–°
```bash
# å®šæœŸæ‹‰å–æ›´æ–°
cd /opt/proxyhub
git pull origin master
docker-compose -f docker-compose.prod.yml up -d --build
```

---

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### 1. ç³»ç»Ÿèµ„æºç›‘æ§
```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h
```

### 2. åº”ç”¨å¥åº·æ£€æŸ¥
```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡å¥åº·çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# æµ‹è¯• API è¿æ¥
curl http://localhost:3000/api/v1/health
```

### 3. æ—¥å¿—è½®è½¬
```bash
# é…ç½® Docker æ—¥å¿—è½®è½¬
vim /etc/docker/daemon.json

{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}

# é‡å¯ Docker
sudo systemctl restart docker
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: æ— æ³•è®¿é—®åº”ç”¨
**A:** æ£€æŸ¥ï¼š
1. é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 80 ç«¯å£ï¼š`sudo firewall-cmd --list-all`
2. è…¾è®¯äº‘å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾ 80 ç«¯å£
3. å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š`docker ps`
4. æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ï¼š`docker-compose logs -f`

### Q2: æ•°æ®åº“è¿æ¥å¤±è´¥
**A:** æ£€æŸ¥ï¼š
1. PostgreSQL å®¹å™¨æ˜¯å¦å¥åº·ï¼š`docker ps | grep postgres`
2. ç¯å¢ƒå˜é‡é…ç½®æ˜¯å¦æ­£ç¡®ï¼š`cat .env.production`
3. æ•°æ®åº“å¯†ç æ˜¯å¦åŒ¹é…

### Q3: API è¿”å› 500 é”™è¯¯
**A:** æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š
```bash
docker-compose -f docker-compose.prod.yml logs -f backend
```

### Q4: å‰ç«¯é¡µé¢ç©ºç™½
**A:** æ£€æŸ¥ï¼š
1. æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. Nginx é…ç½®æ˜¯å¦æ­£ç¡®
3. API URL æ˜¯å¦é…ç½®æ­£ç¡®

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- GitHub Issues: https://github.com/lubei0612/proxyhub/issues
- Telegram: https://t.me/lubei12
- Email: lubei0612@gmail.com

---

## ğŸ‰ éƒ¨ç½²æˆåŠŸï¼

è®¿é—®æ‚¨çš„åº”ç”¨ï¼š
- **å‰ç«¯**: http://your-server-ip æˆ– https://your-domain.com
- **API**: http://your-server-ip:3000/api/v1
- **ç®¡ç†åå°**: http://your-server-ip/admin

**é»˜è®¤ç™»å½•ä¿¡æ¯ï¼š**
- ç®¡ç†å‘˜: `admin@proxy.com` / `admin123456`
- æµ‹è¯•ç”¨æˆ·: `test@test.com` / `test123456`

âš ï¸ **é‡è¦æé†’**ï¼šé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹ç®¡ç†å‘˜å¯†ç ï¼

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€

