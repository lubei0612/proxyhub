# ç™»å½•é—®é¢˜ä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¶é—´**: 2025-11-03  
**é—®é¢˜**: ç”¨æˆ·è¾“å…¥è´¦å·å¯†ç åé¡µé¢é—ªä¸€ä¸‹åˆå›åˆ°ç™»å½•é¡µï¼Œæ— æ³•æˆåŠŸç™»å½•

---

## ğŸ” é—®é¢˜è¯Šæ–­è¿‡ç¨‹

### 1. åˆæ­¥æµ‹è¯•
- ä½¿ç”¨Chrome DevToolsç›´æ¥è°ƒç”¨ç™»å½•API
- å‘ç°åç«¯è¿”å› **401 - å¯†ç é”™è¯¯**

### 2. æ•°æ®åº“æ£€æŸ¥
```bash
node backend/scripts/check-user-password.js
```
**å‘ç°**ï¼šæ•°æ®åº“ä¸­`user@example.com`çš„å¯†ç å“ˆå¸Œæ— æ³•éªŒè¯`123456`

### 3. æ ¹æœ¬åŸå› 
- âŒ æ•°æ®åº“ä¸­çš„æµ‹è¯•ç”¨æˆ·å¯†ç å“ˆå¸Œæ˜¯æ—§çš„/é”™è¯¯çš„
- âŒ seedè„šæœ¬çš„`ON CONFLICT DO UPDATE`åªæ›´æ–°äº†`updated_at`ï¼Œæ²¡æœ‰æ›´æ–°å¯†ç 
- âŒ 401æ‹¦æˆªå™¨åœ¨ç™»å½•é¡µé¢ä¹Ÿä¼šæ¸…é™¤localStorageï¼Œå¯¼è‡´å¾ªç¯

### 4. æ½œåœ¨é—®é¢˜
- âŒ `router.push('/dashboard')`å¯èƒ½åœ¨localStorageå†™å…¥å®Œæˆå‰è§¦å‘
- âŒ 401æ‹¦æˆªå™¨å¯¹æ‰€æœ‰è¯·æ±‚éƒ½ç”Ÿæ•ˆï¼ŒåŒ…æ‹¬ç™»å½•è¯·æ±‚å¤±è´¥æ—¶

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®å¤1ï¼šæ›´æ–°æµ‹è¯•ç”¨æˆ·å¯†ç 
åˆ›å»ºå¹¶æ‰§è¡Œå¯†ç æ›´æ–°è„šæœ¬ï¼š

```bash
node backend/scripts/update-user-passwords.js
```

**ç»“æœ**ï¼š
```
âœ… æ›´æ–° user@example.com / 123456
âœ… æ›´æ–° admin@example.com / admin123
âœ… æ›´æ–° test@example.com / test123
```

### ä¿®å¤2ï¼šä¼˜åŒ–401æ‹¦æˆªå™¨
**æ–‡ä»¶**: `frontend/src/api/request.ts`

```typescript
case 401:
  // åªåœ¨éç™»å½•é¡µé¢æ—¶æ¸…é™¤tokenå¹¶è·³è½¬
  if (window.location.pathname !== '/login') {
    ElMessage.error('æœªæˆæƒï¼Œè¯·é‡æ–°ç™»å½•');
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    localStorage.removeItem('refresh_token');
    window.location.href = '/login';
  }
  break;
```

**æ”¹è¿›**ï¼šé¿å…åœ¨ç™»å½•é¡µé¢æ—¶é”™è¯¯æ¸…é™¤token

### ä¿®å¤3ï¼šä¼˜åŒ–ç™»å½•è·³è½¬é€»è¾‘
**æ–‡ä»¶**: `frontend/src/views/auth/Login.vue`

```typescript
if (success) {
  // ç¡®ä¿localStorageå†™å…¥å®Œæˆåå†è·³è½¬
  await new Promise(resolve => setTimeout(resolve, 100));
  
  // ä½¿ç”¨replaceè€Œä¸æ˜¯pushï¼Œé¿å…è¿”å›åˆ°loginé¡µ
  router.replace('/dashboard');
}
```

**æ”¹è¿›**ï¼š
1. æ·»åŠ 100mså»¶è¿Ÿç¡®ä¿localStorageå†™å…¥å®Œæˆ
2. ä½¿ç”¨`router.replace`è€Œä¸æ˜¯`router.push`ï¼Œé¿å…æµè§ˆå™¨åé€€åˆ°ç™»å½•é¡µ

---

## ğŸ“¦ æ–°å¢å·¥å…·è„šæœ¬

| è„šæœ¬ | ç”¨é€” |
|------|------|
| `backend/scripts/generate-password-hash.js` | ç”Ÿæˆbcryptå¯†ç å“ˆå¸Œ |
| `backend/scripts/seed-users.js` | å¿«é€Ÿæ’å…¥æµ‹è¯•ç”¨æˆ· |
| `backend/scripts/check-user-password.js` | æ£€æŸ¥ç”¨æˆ·å¯†ç æ˜¯å¦æ­£ç¡® |
| `backend/scripts/update-user-passwords.js` | æ›´æ–°æµ‹è¯•ç”¨æˆ·å¯†ç  |
| `backend/src/database/seed-test-data.sql` | å®Œæ•´æµ‹è¯•æ•°æ®SQL |
| `backend/src/database/seed-users-only.sql` | ä»…æµ‹è¯•ç”¨æˆ·SQL |

---

## ğŸ§ª æµ‹è¯•è´¦å·

| é‚®ç®± | å¯†ç  | è§’è‰² | ä½™é¢ | çŠ¶æ€ |
|------|------|------|------|------|
| `user@example.com` | `123456` | user | $975.00 | active |
| `admin@example.com` | `admin123` | admin | $10000.00` | active |
| `test@example.com` | `test123` | user | $500.00 | active |

---

## ğŸš€ æµ‹è¯•æ­¥éª¤

### 1. ç¡®ä¿æœåŠ¡æ­£åœ¨è¿è¡Œ
```bash
# å¦‚æœæ²¡æœ‰è¿è¡Œï¼ŒåŒå‡»ï¼š
å¯åŠ¨ProxyHub.bat
```

### 2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- æŒ‰ `Ctrl+Shift+Delete`
- é€‰æ‹©"Cookieå’Œå…¶ä»–ç½‘ç«™æ•°æ®"
- ç‚¹å‡»"æ¸…é™¤æ•°æ®"

### 3. æµ‹è¯•ç™»å½•
1. è®¿é—® http://localhost:8080
2. è¾“å…¥ `user@example.com` / `123456`
3. ç‚¹å‡»ç™»å½•

**é¢„æœŸç»“æœ**ï¼š
âœ… æ˜¾ç¤º"ç™»å½•æˆåŠŸ"æç¤º
âœ… è‡ªåŠ¨è·³è½¬åˆ°ä»ªè¡¨ç›˜
âœ… æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯å’Œä½™é¢

---

## ğŸ”§ åç»­æ”¹è¿›å»ºè®®

1. **æ•°æ®åº“åˆå§‹åŒ–**
   - åœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œseedè„šæœ¬
   - æˆ–æä¾›ä¸€ä¸ªç®¡ç†åå°çš„"é‡ç½®æµ‹è¯•æ•°æ®"åŠŸèƒ½

2. **ç™»å½•æµç¨‹ä¼˜åŒ–**
   - è€ƒè™‘ä½¿ç”¨Vue Routerçš„metaå­—æ®µæ¥æ ‡è®°è®¤è¯çŠ¶æ€
   - æ·»åŠ æ›´è¯¦ç»†çš„ç™»å½•å¤±è´¥æ—¥å¿—

3. **401å¤„ç†ä¼˜åŒ–**
   - åŒºåˆ†ç™»å½•å¤±è´¥(401)å’Œtokenè¿‡æœŸ(401)
   - å¯¹äºtokenè¿‡æœŸï¼Œå°è¯•è‡ªåŠ¨åˆ·æ–°token

---

## ğŸ“Š æäº¤è®°å½•

```
commit 8cf7aa3
fix(auth): ä¿®å¤ç™»å½•é‡å®šå‘å¾ªç¯é—®é¢˜

âœ… åˆ›å»ºæ•°æ®åº“seedè„šæœ¬ï¼Œæ’å…¥æ­£ç¡®çš„æµ‹è¯•ç”¨æˆ·
âœ… ä¿®å¤401æ‹¦æˆªå™¨ï¼Œç™»å½•é¡µé¢ä¸æ¸…é™¤token
âœ… Login.vueä½¿ç”¨router.replaceå¹¶æ·»åŠ 100mså»¶è¿Ÿ
```

---

**ä¿®å¤å®Œæˆï¼ç°åœ¨ç”¨æˆ·åº”è¯¥å¯ä»¥æ­£å¸¸ç™»å½•äº†ã€‚** ğŸ‰

