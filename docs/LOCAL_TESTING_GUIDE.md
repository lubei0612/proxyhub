# 🧪 ProxyHub 本地测试指南

> 📅 测试日期：2025-11-02  
> ✅ 状态：所有Phase已完成，准备验收测试  
> 🎯 目标：完整验收所有功能，为腾讯云部署做准备

---

## 📋 测试前准备

### 1. 环境要求
- Node.js 18+
- PostgreSQL 15+
- Redis 7+ (可选)
- Docker & Docker Compose (推荐)

### 2. 启动服务

#### 方式1：使用Docker Compose（推荐）⭐

```bash
# 1. 复制环境变量模板
cp docs/ENV_TEMPLATE.txt .env

# 2. 编辑.env文件（可选，默认配置可直接使用）
# vim .env

# 3. 启动所有服务
docker-compose up -d

# 4. 等待服务启动（约30秒）
docker-compose ps

# 5. 运行基础种子数据
docker exec -it proxyhub-backend npm run seed

# 6. 运行扩展测试数据（为验收添加更多数据）
docker exec -it proxyhub-backend npm run seed:extended
```

#### 方式2：本地开发

```bash
# 1. 启动数据库
docker-compose up postgres redis -d

# 2. 启动后端
cd backend
cp .env.example .env
# 编辑.env文件，配置数据库连接
npm install
npm run seed          # 基础数据
npm run seed:extended # 扩展测试数据
npm run start:dev     # 启动后端

# 3. 启动前端（新终端）
cd frontend
npm install
npm run dev           # 启动前端
```

### 3. 访问应用

- **前端**：http://localhost:80 (Docker) 或 http://localhost:5173 (本地开发)
- **后端API**：http://localhost:3000/api/v1
- **API文档**：http://localhost:3000/api/v1/docs

---

## 🔑 测试账号

### 用户账号
```
管理员：
- 邮箱：admin@example.com
- 密码：admin123
- 余额：$10,000

普通用户（主要测试账号）：
- 邮箱：user@example.com
- 密码：password123
- 余额：$1,000
- 已有数据：20+ 静态IP、10个订单、15个充值订单、30条交易记录

测试用户1：
- 邮箱：alice@test.com
- 密码：password123
- 余额：$500

测试用户2：
- 邮箱：bob@test.com
- 密码：password123
- 余额：$2,000

测试用户3：
- 邮箱：charlie@test.com
- 密码：password123
- 余额：$100
```

---

## ✅ 功能验收清单

### 1. 用户认证 ✓

#### 1.1 登录功能
- [ ] 使用`user@example.com`登录成功
- [ ] 使用错误密码登录失败
- [ ] 使用不存在的邮箱登录失败
- [ ] "记住我"功能
- [ ] 语言切换功能（点击右上角地球图标）

#### 1.2 注册功能
- [ ] 注册新用户
- [ ] 邮箱格式验证
- [ ] 密码确认验证
- [ ] 注册成功后自动登录

#### 1.3 退出登录
- [ ] 退出登录后跳转到登录页
- [ ] 退出后无法访问受保护页面

---

### 2. 仪表盘 (Dashboard) ✓

#### 2.1 数据展示
- [ ] 数据中心使用统计（柱状图）
  - 显示4种代理类型：Data Center、Mobile、Res Rotating、Res Static
  - 纵向柱状图
  - 数据单位：GB
- [ ] 网络请求分析（饼图）
  - 显示请求分布
  - 带百分比标签
- [ ] 流量使用趋势（折线图）
  - 显示4条曲线：DC、Mobile、Res Rotating、Res Static
  - 时间轴为UTC时间
  - 数据单位：GB

#### 2.2 交互功能
- [ ] 图表数据刷新
- [ ] 图表缩放和交互
- [ ] 响应式布局（缩放浏览器窗口）

---

### 3. 静态住宅代理 ✓

#### 3.1 静态IP选购
- [ ] 页面加载正常
- [ ] IP类型选择（普通/原生）
  - 普通IP：$5/月
  - 原生IP：$8/月
- [ ] 时长选择（30/60/90/180/360天）
- [ ] 业务场景选择（7个选项）
- [ ] 大洲筛选（所有/欧洲/南美洲/亚洲/北美洲）
- [ ] 国家卡片网格（4列布局）
- [ ] 国旗正常显示
- [ ] 库存显示正确
- [ ] 购买数量输入（最小0，最大为库存数）
- [ ] 支付面板sticky效果（滚动页面时固定）
- [ ] 未选择IP时显示"请先选择IP"提示
- [ ] 已选择IP时显示订单明细
- [ ] 价格计算正确
- [ ] 汇率换算正确（USD↔CNY）
- [ ] 支付方式选择
- [ ] 余额不足时显示警告
- [ ] 提交订单功能

#### 3.2 静态IP管理
- [ ] 页面加载正常，显示20+个IP
- [ ] IP列表展示（IP:Port:Username:Password格式）
- [ ] 筛选功能
  - 按IP搜索
  - 按国家筛选
  - 按城市筛选
  - 按IP类型筛选（普通/原生）
- [ ] 批量选择
- [ ] 批量导出
  - 导出为CSV
  - 导出为TXT（IP:Port:User:Pass格式）
- [ ] 批量续费
  - 选择续费时长
  - 计算续费价格
  - 确认续费
- [ ] 单个IP续费
- [ ] 单个IP释放
  - 确认对话框
  - 释放后状态更新
- [ ] 分页功能
- [ ] 国旗正常显示

---

### 4. 动态住宅代理 ✓

#### 4.1 动态代理管理
- [ ] 页面加载正常
- [ ] 显示"联系客服购买"提示
- [ ] Telegram客服链接可点击
- [ ] 如已购买套餐，显示套餐信息
  - 套餐名称
  - 流量单价
  - 已用流量
  - 剩余流量
  - 状态（运行中/已暂停）

#### 4.2 动态代理选购
- [ ] 页面加载正常
- [ ] 显示联系客服信息
- [ ] Telegram链接正常

---

### 5. 账单管理 ✓

#### 5.1 费用明细
- [ ] 页面加载正常
- [ ] 显示交易记录
- [ ] 筛选功能
  - 按交易类型
  - 按日期范围
  - 按金额范围
- [ ] 分页功能
- [ ] 数据导出

#### 5.2 交易记录
- [ ] 页面加载正常，显示30+条记录
- [ ] 显示交易详情
  - 交易单号
  - 交易类型（充值/购买/退款）
  - 金额
  - 交易前余额
  - 交易后余额
  - 时间
- [ ] 筛选功能
- [ ] 分页功能
- [ ] 导出功能

#### 5.3 结算记录
- [ ] 页面加载正常
- [ ] 显示结算明细
- [ ] 查看详情功能

#### 5.4 充值订单
- [ ] 页面加载正常，显示15+个订单
- [ ] 订单列表展示
  - 订单号
  - 充值金额
  - 支付方式（微信/支付宝/USDT/美金）
  - 状态（待审核/已批准/已拒绝）
  - 申请时间
  - 审核时间
- [ ] 筛选功能
  - 按订单号搜索
  - 按状态筛选
  - 按支付方式筛选
  - 按金额范围筛选
  - 按时间范围筛选
- [ ] 查看详情功能
  - 显示订单详细信息
  - 显示拒绝原因（如有）
- [ ] 导出功能（CSV）
- [ ] 分页功能

---

### 6. 钱包充值 ✓

#### 6.1 充值申请
- [ ] 页面加载正常
- [ ] 充值金额输入（最小$1，最大$10,000）
- [ ] 快捷金额选择（$10/$50/$100/$500/$1000）
- [ ] 充值预览
  - USD金额
  - CNY折合
  - 当前汇率
- [ ] 支付方式选择
  - 微信支付
  - 支付宝
  - USDT（TRC20）
  - 美金支付
  - 每种方式显示说明文字
- [ ] 备注信息输入
- [ ] 联系客服按钮（Telegram）
- [ ] 提交充值申请
- [ ] 提交成功提示

---

### 7. 账户中心 ✓

#### 7.1 个人信息
- [ ] 显示邮箱
- [ ] 显示昵称
- [ ] 显示账户余额
- [ ] 显示赠送余额
- [ ] 显示注册时间
- [ ] 显示最后登录时间

#### 7.2 安全设置
- [ ] 修改密码
  - 旧密码验证
  - 新密码输入
  - 确认密码验证
  - 修改成功提示

#### 7.3 客服支持
- [ ] 显示Telegram客服链接
- [ ] 链接可点击跳转

#### 7.4 事件日志
- [ ] 页面加载正常
- [ ] 显示事件记录
  - #ID
  - 事件类型（登录/退出/购买/续费/释放）
  - 事件内容
  - 事件时间
- [ ] **不显示IP地址和设备信息（隐私保护）**
- [ ] 分页功能

---

### 8. 管理后台 ✓

#### 8.1 管理员登录
- [ ] 使用`admin@example.com`登录
- [ ] 进入管理后台界面
- [ ] 侧边栏菜单正常显示
- [ ] 页面滚动正常（修复后）

#### 8.2 用户管理
- [ ] 用户列表加载
- [ ] 显示5个用户
- [ ] 用户信息展示
  - 用户ID
  - 邮箱
  - 昵称
  - 角色
  - 余额
  - 状态
- [ ] 编辑用户功能
- [ ] 禁用/启用用户

#### 8.3 充值审批
- [ ] 充值订单列表（15+个）
- [ ] 筛选待审核订单
- [ ] 查看订单详情
  - 订单号
  - 用户信息
  - 充值金额
  - 支付方式
  - 备注信息
- [ ] 批准充值
  - 确认对话框
  - 批准成功提示
  - 订单状态更新
  - 用户余额更新
- [ ] 拒绝充值
  - 输入拒绝原因
  - 拒绝成功提示
  - 订单状态更新

#### 8.4 价格覆盖管理
- [ ] 页面加载正常
- [ ] 显示3个价格覆盖（日本、韩国、新加坡）
- [ ] 价格覆盖列表
  - 产品类型
  - 国家代码
  - 城市名称
  - 覆盖价格
  - 状态
- [ ] 创建新覆盖
  - 选择产品类型
  - 输入国家代码
  - 输入城市名称（可选）
  - 输入覆盖价格
  - 启用/禁用
- [ ] 编辑覆盖
- [ ] 删除覆盖

#### 8.5 系统设置
- [ ] 页面加载正常
- [ ] 汇率管理
  - 显示当前USD→CNY汇率
  - 修改汇率
  - 保存成功提示
- [ ] Telegram客服配置
- [ ] 其他系统设置

---

### 9. 多语言支持 ✓

#### 9.1 语言切换
- [ ] 点击右上角地球图标
- [ ] 选择"简体中文"
  - 界面切换为中文
  - 提示"语言已切换为简体中文"
  - 页面自动刷新
- [ ] 选择"English"
  - 界面切换为英文
  - 提示"Language switched to English"
  - 页面自动刷新

#### 9.2 语言持久化
- [ ] 刷新页面后语言设置保持
- [ ] 退出登录后语言设置保持
- [ ] 重新登录后语言设置保持

---

### 10. 响应式设计 ✓

#### 10.1 桌面端（>1400px）
- [ ] 所有功能正常显示
- [ ] 静态IP选购：4列卡片网格
- [ ] 布局合理，无遮挡

#### 10.2 中屏（1024-1400px）
- [ ] 静态IP选购：3列卡片网格
- [ ] 表格内容自适应
- [ ] 侧边栏自适应

#### 10.3 小屏（<1024px）
- [ ] 静态IP选购：2列卡片网格
- [ ] 移动端菜单（汉堡菜单）
- [ ] 表格横向滚动
- [ ] 触摸操作友好

---

## 🐛 常见问题排查

### 1. 服务无法启动

**问题**：Docker容器无法启动

**解决方案**：
```bash
# 查看日志
docker-compose logs -f

# 重启服务
docker-compose restart

# 完全重建
docker-compose down -v
docker-compose up -d --build
```

### 2. 数据库连接失败

**问题**：后端无法连接数据库

**解决方案**：
```bash
# 检查PostgreSQL是否运行
docker-compose ps postgres

# 查看数据库日志
docker-compose logs postgres

# 检查环境变量配置
cat .env | grep DATABASE
```

### 3. 前端API请求失败

**问题**：前端无法访问后端API

**解决方案**：
```bash
# 检查后端是否运行
curl http://localhost:3000/api/v1/health

# 检查CORS配置
# backend/.env 中确认 CORS_ORIGIN 配置正确
```

### 4. 种子数据未加载

**问题**：登录后没有测试数据

**解决方案**：
```bash
# 重新运行种子数据脚本
docker exec -it proxyhub-backend npm run seed
docker exec -it proxyhub-backend npm run seed:extended

# 或本地开发环境
cd backend
npm run seed
npm run seed:extended
```

### 5. 页面显示空白

**问题**：前端页面空白或报错

**解决方案**：
```bash
# 查看浏览器控制台错误
# F12 → Console 查看错误信息

# 清除浏览器缓存
# Ctrl+Shift+R 强制刷新

# 重新构建前端
cd frontend
npm run build
```

---

## 📸 测试截图建议

建议截图保存以下关键页面（用于验收报告）：

1. 登录页面
2. 仪表盘（3个图表）
3. 静态IP选购（4列卡片网格）
4. 静态IP管理（20+个IP）
5. 充值订单页面（15+个订单）
6. 交易记录页面（30+条记录）
7. 管理后台 - 充值审批
8. 管理后台 - 价格覆盖管理
9. 语言切换（中英文对比）
10. 移动端适配效果

---

## 🗑️ 清理测试数据

**在腾讯云部署前，请清理测试数据！**

### 方式1：重置数据库（推荐）

```bash
# 停止所有服务
docker-compose down -v

# 删除数据卷（清空数据库）
docker volume rm proxyhub_postgres_data

# 重新启动服务
docker-compose up -d

# 只运行基础种子数据（不运行extended）
docker exec -it proxyhub-backend npm run seed
```

### 方式2：手动删除扩展测试数据

```sql
-- 连接到数据库
psql -h localhost -U postgres -d proxyhub

-- 删除扩展测试数据（保留基础用户和配置）
DELETE FROM static_proxies WHERE id > 3;
DELETE FROM orders WHERE id > 2;
DELETE FROM recharges WHERE id > 3;
DELETE FROM transactions WHERE id > 2;
DELETE FROM event_logs WHERE id > 0;

-- 退出
\q
```

---

## ✅ 验收通过标准

- [ ] 所有功能验收清单项 100% 通过
- [ ] 无严重Bug或阻塞性问题
- [ ] 性能响应时间 < 2秒
- [ ] 界面无错位或样式问题
- [ ] 多语言切换正常
- [ ] 移动端适配正常
- [ ] 测试数据清理完成

---

## 🚀 验收通过后的下一步

1. **清理测试数据**（见上文）
2. **准备腾讯云部署**
   - 按照 `docs/FINAL_DELIVERY_SUMMARY.md` 中的"部署到腾讯云"章节执行
   - 配置域名和SSL证书
   - 配置防火墙规则
3. **生产环境测试**
   - 使用真实985Proxy API Key
   - 测试完整购买流程
   - 测试充值审批流程
4. **上线**
   - 创建管理员账号
   - 配置系统设置
   - 通知用户开始使用

---

**祝测试顺利！🎉**

