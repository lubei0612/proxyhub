===============================================
  ProxyHub 生产环境部署 - 服务器指令
  服务器IP: 43.130.35.117
===============================================

【重要】请按顺序执行以下步骤：

===============================================
步骤1: SSH登录服务器
===============================================

ssh root@43.130.35.117


===============================================
步骤2: 清理旧部署（如果存在）
===============================================

cd ~
rm -rf proxyhub


===============================================
步骤3: 执行一键部署脚本
===============================================

bash <(curl -s https://raw.githubusercontent.com/lubei0612/proxyhub/master/scripts/deploy-production.sh)


===============================================
步骤4: 根据提示配置环境变量
===============================================

当看到提示 "⚠️  请编辑 .env 文件，填入您的 API 密钥和邮箱配置" 时：

1. 按回车继续，会自动打开编辑器
2. 找到以下几行并填入您的配置：

PROXY_985_API_KEY=ne_hj06qomI-bmVfaGowNnFvbUk0YzIzMTc2MTQ1Nzk1Mw==
PROXY_985_ZONE=6jd4ftbl7kv3
MAIL_USER=RobinsonKevin5468@outlook.com
MAIL_PASSWORD=ugfqftyq60695
MAIL_USER_BACKUP=chenyuqi061245@gmail.com
MAIL_PASSWORD_BACKUP=vvdgyeerdtycwxka

3. 保存并退出：
   - 按 Ctrl+X
   - 按 Y
   - 按 Enter

4. 等待部署完成...


===============================================
步骤5: 保存部署信息
===============================================

部署完成后，屏幕会显示：

访问信息:
  前端: http://43.130.35.117
  API:  http://43.130.35.117:3000/api/v1

管理员账号:
  邮箱: admin@proxyhub.com
  密码: <随机生成的安全密码>

⚠️ 请立即保存管理员密码！


===============================================
步骤6: 验证部署
===============================================

# 检查服务状态
cd ~/proxyhub
docker-compose ps

# 应该看到所有服务都是 Up (healthy)


===============================================
步骤7: 登录并修改密码
===============================================

1. 打开浏览器访问: http://43.130.35.117
2. 使用部署时输出的管理员账号登录
3. 立即修改管理员密码


===============================================
常用管理命令
===============================================

# 查看日志
docker-compose logs -f backend

# 重启服务
docker-compose restart

# 停止服务
docker-compose down

# 启动服务
docker-compose up -d

# 手动备份
bash scripts/db-backup.sh

# 查看备份
ls -lh /var/backups/proxyhub/


===============================================
自动化功能
===============================================

✅ 每天凌晨2点自动备份数据库
✅ 保留最近7天的备份
✅ 推送代码到GitHub后自动部署（需配置GitHub Secrets）


===============================================
配置GitHub Actions自动部署（可选）
===============================================

1. 在GitHub仓库 Settings -> Secrets and variables -> Actions
2. 添加以下Secrets：
   - SERVER_HOST: 43.130.35.117
   - SERVER_USER: root
   - SERVER_SSH_KEY: <您的SSH私钥>

3. 生成SSH密钥对（在本地执行）：
   ssh-keygen -t rsa -b 4096 -f ~/.ssh/proxyhub_deploy
   
4. 将公钥添加到服务器：
   ssh root@43.130.35.117
   mkdir -p ~/.ssh
   echo "你的公钥内容" >> ~/.ssh/authorized_keys
   chmod 600 ~/.ssh/authorized_keys

5. 将私钥内容复制到GitHub Secrets的SERVER_SSH_KEY


===============================================
部署完成检查清单
===============================================

- [ ] 所有服务状态为 healthy
- [ ] 前端可以访问
- [ ] 管理员可以登录
- [ ] 已保存管理员密码
- [ ] 已修改管理员密码
- [ ] 备份任务已配置
- [ ] 日志正常输出


===============================================
技术支持
===============================================

- 详细文档: SERVER-DEPLOYMENT.md
- 安全指南: docs/deployment/SECURITY-GUIDE.md
- 问题反馈: https://github.com/lubei0612/proxyhub/issues


===============================================
🎉 准备就绪！现在可以开始部署了！
===============================================

