# âš ï¸ ç»­è´¹æ–¹æ³•åˆ†ææŠ¥å‘Š

## å‘ç°çš„é—®é¢˜

ç³»ç»Ÿæœ‰**ä¸¤ä¸ªç»­è´¹æ–¹æ³•**ï¼Œåªæœ‰ä¸€ä¸ªåº”ç”¨äº†ä»·æ ¼è¦†ç›–ï¼

---

## æ–¹æ³•å¯¹æ¯”

### âœ… æ–¹æ³•1: `renewProxy` (æ­£ç¡®)

**ä½ç½®**: `static-proxy.service.ts:848`  
**APIç«¯ç‚¹**: `POST /proxy/static/:id/renew`  
**å‰ç«¯è°ƒç”¨**: `renewStaticProxy(proxy.id, duration)`  
**ä»·æ ¼è®¡ç®—**: âœ… ä½¿ç”¨ `PricingService.calculatePrice(dto, userId)` - **åº”ç”¨ä»·æ ¼è¦†ç›–**

```typescript
const priceResult = await this.pricingService.calculatePrice({
  productType,
  buyData: [{ country_code: proxy.country, city_name: proxy.cityName, count: 1 }],
  timePeriod: duration,
}, parseInt(userId)); // âœ… åº”ç”¨ä»·æ ¼è¦†ç›–
```

**çŠ¶æ€**: âœ… å·²ä¿®å¤ï¼Œæ­£ç¡®åº”ç”¨ä»·æ ¼è¦†ç›–

---

### âŒ æ–¹æ³•2: `renewIPVia985Proxy` (æœ‰é—®é¢˜)

**ä½ç½®**: `static-proxy.service.ts:628`  
**APIç«¯ç‚¹**: `POST /proxy/static/ip/:ip/renew`  
**å‰ç«¯è°ƒç”¨**: `renewIPVia985(ip, duration)` (å·²åºŸå¼ƒï¼Ÿ)  
**ä»·æ ¼è®¡ç®—**: âŒ ç›´æ¥ä½¿ç”¨ 985Proxy API - **ä¸åº”ç”¨ä»·æ ¼è¦†ç›–**

```typescript
// âŒ ç›´æ¥ä½¿ç”¨985Proxyä»·æ ¼ï¼Œä¸åº”ç”¨ç³»ç»Ÿä»·æ ¼è¦†ç›–
const priceResponse = await this.proxy985Service.calculatePrice({
  action: 'renew',
  time_period: duration,
  zone,
  renew_ip_list: [ip],
});

const renewalCost = parseFloat(priceResponse.data.pay_price || '0');
```

**é—®é¢˜**: è¿™ä¸ªæ–¹æ³•å®Œå…¨ç»•è¿‡äº†PricingServiceï¼Œç›´æ¥ä½¿ç”¨985Proxyçš„åŸå§‹ä»·æ ¼ï¼

**å½±å“**: 
- âŒ ä¸åº”ç”¨å…¨å±€ä»·æ ¼è¦†ç›–
- âŒ ä¸åº”ç”¨ç”¨æˆ·ç‰¹å®šä»·æ ¼è¦†ç›–
- âŒ ç”¨æˆ·æ— æ³•äº«å—ä¸“å±ä»·æ ¼

---

## å‰ç«¯ä½¿ç”¨æƒ…å†µ

### å½“å‰å‰ç«¯ä»£ç  (StaticManage.vue:702)

```typescript
await renewStaticProxy(proxy.id, renewDuration.value);
```

**æ˜ å°„**: `POST /proxy/static/:id/renew` â†’ `renewProxy` âœ…

**ç»“è®º**: âœ… å‰ç«¯ä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„æ–¹æ³•ï¼ˆæ–¹æ³•1ï¼‰ï¼Œ**ä»·æ ¼è¦†ç›–ä¼šç”Ÿæ•ˆ**

---

## é£é™©åˆ†æ

### ğŸŸ¢ å½“å‰é£é™©: ä½

å‰ç«¯ä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„æ–¹æ³•ï¼Œæ‰€ä»¥**å½“å‰ç”¨æˆ·ç»­è´¹åŠŸèƒ½æ­£å¸¸ï¼Œä¼šåº”ç”¨ä»·æ ¼è¦†ç›–**ã€‚

### ğŸŸ¡ æ½œåœ¨é£é™©: ä¸­

å¦‚æœå°†æ¥æœ‰ä»¥ä¸‹æƒ…å†µï¼š
1. æœ‰å…¶ä»–æœåŠ¡/è„šæœ¬è°ƒç”¨ `renewIPVia985Proxy` æ–¹æ³•
2. æœ‰å…¶ä»–å‰ç«¯é¡µé¢ç›´æ¥è°ƒç”¨ `POST /proxy/static/ip/:ip/renew`
3. ç®¡ç†å‘˜ä½¿ç”¨è¯¥APIè¿›è¡Œæ‰¹é‡ç»­è´¹

é‚£ä¹ˆ**ä»·æ ¼è¦†ç›–å°†ä¸ä¼šç”Ÿæ•ˆ**ï¼

---

## å»ºè®®ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä¿®å¤ `renewIPVia985Proxy` æ–¹æ³•ï¼ˆæ¨èï¼‰

```typescript
async renewIPVia985Proxy(userId: string, ip: string, duration: number) {
  // ... çœç•¥å‰é¢çš„ä»£ç  ...

  // âœ… ä½¿ç”¨PricingServiceè®¡ç®—ä»·æ ¼ï¼ˆåº”ç”¨è¦†ç›–ï¼‰
  const productType = proxy.ipType === 'native' ? 'static-residential-native' : 'static-residential';
  const priceResult = await this.pricingService.calculatePrice({
    productType,
    buyData: [{ country_code: proxy.country, city_name: proxy.cityName, count: 1 }],
    timePeriod: duration,
  }, parseInt(userId)); // âœ… åº”ç”¨ä»·æ ¼è¦†ç›–
  
  const renewalCost = priceResult.totalPrice;

  // ... å…¶ä½™ä»£ç ä¿æŒä¸å˜ ...
}
```

### æ–¹æ¡ˆ2: åºŸå¼ƒè¯¥æ–¹æ³•ï¼ˆå¦‚æœä¸å†ä½¿ç”¨ï¼‰

å¦‚æœè¿™ä¸ªæ–¹æ³•ä¸å†ä½¿ç”¨ï¼Œå¯ä»¥ï¼š
1. æ·»åŠ  `@Deprecated()` æ ‡è®°
2. åœ¨æ–‡æ¡£ä¸­è¯´æ˜å·²åºŸå¼ƒ
3. å°†æ¥çš„ç‰ˆæœ¬ä¸­ç§»é™¤

---

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ–¹æ³•1 (renewProxy) - âœ… å·²éªŒè¯

```bash
# ä½¿ç”¨å‰ç«¯ç»­è´¹åŠŸèƒ½
POST /proxy/static/123/renew
Body: { "duration": 30 }

# é¢„æœŸï¼šåº”ç”¨ä»·æ ¼è¦†ç›–ï¼ˆAR: $3, ä¸æ˜¯$5ï¼‰
```

### æµ‹è¯•æ–¹æ³•2 (renewIPVia985Proxy) - âš ï¸ éœ€è¦æµ‹è¯•

```bash
# ç›´æ¥è°ƒç”¨API
POST /proxy/static/ip/1.2.3.4/renew
Body: { "duration": 30 }

# å½“å‰è¡Œä¸ºï¼šä¸åº”ç”¨ä»·æ ¼è¦†ç›–ï¼ˆå§‹ç»ˆä½¿ç”¨985ProxyåŸä»·ï¼‰
# é¢„æœŸè¡Œä¸ºï¼šåº”è¯¥åº”ç”¨ä»·æ ¼è¦†ç›–
```

---

## ç»“è®º

### âœ… å¥½æ¶ˆæ¯
**å‰ç«¯ç”¨æˆ·çš„ç»­è´¹åŠŸèƒ½æ˜¯å®‰å…¨çš„**ï¼Œä½¿ç”¨çš„æ˜¯æ­£ç¡®çš„æ–¹æ³•ï¼Œ**ä»·æ ¼è¦†ç›–ä¼šæ­£å¸¸ç”Ÿæ•ˆ**ã€‚

### âš ï¸ å»ºè®®
ä¸ºäº†ç³»ç»Ÿå®Œæ•´æ€§å’Œæœªæ¥çš„æ‰©å±•æ€§ï¼Œ**å»ºè®®ä¿®å¤ `renewIPVia985Proxy` æ–¹æ³•**ï¼Œä½¿å…¶ä¹Ÿåº”ç”¨ä»·æ ¼è¦†ç›–ã€‚

### ğŸ¯ ä¼˜å…ˆçº§
- **å½“å‰æµ‹è¯•**: é«˜ä¼˜å…ˆçº§ï¼ˆæµ‹è¯•å‰ç«¯ç»­è´¹åŠŸèƒ½ï¼Œä½¿ç”¨æ–¹æ³•1ï¼‰
- **ä¿®å¤æ–¹æ³•2**: ä¸­ä¼˜å…ˆçº§ï¼ˆç³»ç»Ÿå®Œæ•´æ€§ï¼Œä½†ä¸å½±å“å½“å‰ç”¨æˆ·ï¼‰

---

**æŠ¥å‘Šæ—¶é—´**: 2025-11-10 09:25  
**çŠ¶æ€**: å‰ç«¯åŠŸèƒ½æ­£å¸¸ï¼Œå»ºè®®ä¿®å¤å®Œæ•´æ€§é—®é¢˜

