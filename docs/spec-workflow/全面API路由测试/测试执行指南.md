# ProxyHub 全面API路由测试 - 执行指南

**日期**: 2025-11-04  
**使用工具**: Chrome DevTools + 手动操作  
**预计时间**: 2小时  

---

## 🚀 测试前准备

### 1. 启动服务

**选项A: 使用启动脚本（推荐）**
```bash
双击运行: 启动ProxyHub测试服务.bat
```

**选项B: 手动启动**
```bash
# 终端1 - 后端
cd backend
npm run start:dev

# 终端2 - 前端
cd frontend  
npm run dev
```

### 2. 确认服务状态

- [ ] 后端: http://localhost:3000 ✅
- [ ] 前端: http://localhost:8080 ✅
- [ ] 数据库: PostgreSQL连接正常 ✅

### 3. 准备测试账户

**用户账户**:
- 邮箱: `user@example.com`
- 密码: `user123`

**管理员账户**:
- 邮箱: `admin@example.com`
- 密码: `admin123`

### 4. 打开Chrome DevTools

```
F12 或 右键→检查
```

关注标签:
- **Network**: API请求/响应
- **Console**: 日志和错误
- **Application**: 存储和缓存

---

## 📋 Phase 1: 认证和基础功能测试（30分钟）

### Test 1.1: 用户注册

**操作步骤**:
1. 访问 `http://localhost:8080/register`
2. 填写表单:
   - 邮箱: `testuser@example.com`
   - 用户名: `测试用户`
   - 密码: `test123`
   - 确认密码: `test123`
3. 点击"注册"

**DevTools验证**:
```
Network → 查找:
  POST /api/v1/auth/register
  Status: 201
  Response: { message: "注册成功" }

Console → 查找:
  无错误日志
```

**页面验证**:
- [ ] 显示注册成功提示
- [ ] 自动跳转到登录页

**结果**: ✅ / ❌

---

### Test 1.2: 用户登录

**操作步骤**:
1. 使用 `user@example.com` / `user123` 登录
2. 观察页面跳转

**DevTools验证**:
```
Network → 查找:
  POST /api/v1/auth/login
  Status: 200/201
  Response: { access_token: "...", user: {...} }

Application → Local Storage:
  token: "eyJ..."
  user: {id, email, ...}
```

**页面验证**:
- [ ] 登录成功提示
- [ ] 跳转到仪表盘
- [ ] 导航栏显示用户信息
- [ ] 导航栏显示余额

**结果**: ✅ / ❌

---

### Test 1.3: 管理员登录

**操作步骤**:
1. 退出当前用户
2. 访问 `http://localhost:8080/admin/login`
3. 使用 `admin@example.com` / `admin123` 登录

**DevTools验证**:
```
Network → 查找:
  POST /api/v1/auth/admin-login
  Status: 200/201
  Response: { access_token: "...", user: {role: "admin"} }
```

**页面验证**:
- [ ] 跳转到管理后台仪表盘
- [ ] 侧边栏显示管理菜单
- [ ] 显示管理员专属功能

**结果**: ✅ / ❌

---

### Test 1.4: Token刷新

**操作步骤**:
1. 等待约10分钟（或修改token过期时间）
2. 执行任意需要认证的操作

**DevTools验证**:
```
Network → 查找:
  POST /api/v1/auth/refresh
  Status: 200/201
  Response: { access_token: "..." }
```

**结果**: ✅ / ❌ / ⏭️（跳过）

---

## 📋 Phase 2: 核心业务功能测试（45分钟）

### Test 2.1: 静态代理购买（普通IP）

**准备**: 以用户身份登录

**操作步骤**:
1. 导航: 静态住宅 → 静态住宅选购
2. 选择"普通"IP类型
3. 选择日本 Tokyo，数量 1
4. 选择30天
5. 验证价格显示: **$10/月** （价格覆盖）
6. 点击"提交订单"

**DevTools验证**:
```
Network → 依次查找:

1. GET /api/v1/proxy/static/inventory
   验证: 库存数据加载

2. POST /api/v1/price/calculate
   Request: {
     productType: "static-residential",
     buyData: [{country_code: "JP", city_name: "Tokyo", count: 1}],
     timePeriod: 30
   }
   Response: {
     breakdown: [{location: "JP/Tokyo", unitPrice: 10, ...}]
   }

3. POST /api/v1/proxy/static/purchase
   Request: {
     items: [{country: "JP", city: "Tokyo", quantity: 1}],
     ipType: "shared",
     duration: 30
   }
   Status: 200/201
   Response: { proxies: [...], order: {...} }

4. GET /api/v1/users/profile
   验证: 余额更新
```

**页面验证**:
- [ ] 价格显示 $10/月 ✅
- [ ] 提交成功提示
- [ ] 余额减少 $10
- [ ] 跳转到静态住宅管理
- [ ] 代理列表显示新IP

**数据验证**（后续检查）:
- [ ] 订单记录存在
- [ ] 交易明细存在
- [ ] **管理员可见订单**

**结果**: ✅ / ❌

---

### Test 2.2: 静态代理购买（原生IP）

**操作步骤**:
1. 返回静态住宅选购
2. 选择"原生"IP类型
3. 选择美国 Los Angeles，数量 2
4. 选择60天
5. 验证价格: $10/月 × 2 × 2 = **$40**
6. 提交订单

**DevTools验证**:
```
Network → 查找:

POST /api/v1/price/calculate
  Request: {
    productType: "static-residential-native",
    ...
  }
  Status: 201 (不再是404!)
  Response: {
    breakdown: [...],
    totalPrice: 40
  }

POST /api/v1/proxy/static/purchase
  Request: {
    items: [{country: "US", city: "Los Angeles", quantity: 2}],
    ipType: "premium",
    duration: 60
  }
  Status: 200/201
```

**页面验证**:
- [ ] 原生IP价格正确显示
- [ ] 总价计算正确 ($40)
- [ ] 购买成功
- [ ] 余额扣除正确

**结果**: ✅ / ❌

---

### Test 2.3: 代理列表查询

**操作步骤**:
1. 导航: 静态住宅 → 静态住宅管理
2. 查看代理列表

**DevTools验证**:
```
Network → 查找:
  GET /api/v1/proxy/static/list
  Status: 200
  Response: {
    data: [...],
    total: 3
  }
```

**页面验证**:
- [ ] 显示之前购买的3个IP
  - 1个日本Tokyo (普通)
  - 2个美国LA (原生)
- [ ] 显示正确的状态、到期时间
- [ ] 可以设置备注
- [ ] 可以设置自动续费

**结果**: ✅ / ❌

---

### Test 2.4: 充值申请

**操作步骤**:
1. 导航: 钱包充值
2. 填写充值信息:
   - 金额: 100
   - 支付方式: 支付宝
   - 交易单号: TEST20251104001
   - 备注: 测试充值
3. 上传支付凭证（可选）
4. 提交

**DevTools验证**:
```
Network → 查找:
  POST /api/v1/billing/recharge
  Request: {
    amount: 100,
    paymentMethod: "alipay",
    transactionNo: "TEST20251104001",
    ...
  }
  Status: 200/201
  Response: {
    id: 1,
    status: "pending",
    ...
  }
```

**页面验证**:
- [ ] 提交成功提示
- [ ] 充值记录列表显示新记录
- [ ] 状态显示"待审核"

**结果**: ✅ / ❌

---

### Test 2.5: 订单列表查询

**操作步骤**:
1. 导航: 账单明细 → 订单记录
2. 查看订单列表

**DevTools验证**:
```
Network → 查找:
  GET /api/v1/orders
  Status: 200
  Response: {
    data: [...],
    total: 2
  }
```

**页面验证**:
- [ ] 显示2个订单
  - 日本Tokyo购买记录
  - 美国LA购买记录
- [ ] 订单金额正确
- [ ] 订单状态正确

**结果**: ✅ / ❌

---

### Test 2.6: 交易明细查询

**操作步骤**:
1. 导航: 账单明细 → 交易明细
2. 查看交易记录

**DevTools验证**:
```
Network → 查找:
  GET /api/v1/billing/transactions
  Status: 200
  Response: {
    data: [...],
    total: 2
  }
```

**页面验证**:
- [ ] 显示购买扣款记录
  - 日本Tokyo: -$10
  - 美国LA: -$40
- [ ] 余额变化显示正确
- [ ] 时间戳正确

**结果**: ✅ / ❌

---

## 📋 Phase 3: 管理功能测试（30分钟）

### Test 3.1: 管理员查看所有订单

**准备**: 切换到管理员账户

**操作步骤**:
1. 管理员登录
2. 导航: 订单管理
3. 查看订单列表

**DevTools验证**:
```
Network → 查找:
  GET /api/v1/orders/admin/all
  Status: 200
  Response: {
    data: [...],  // 包含所有用户的订单
    total: >= 2
  }
```

**关键验证**:
- [ ] **能看到普通用户的订单**
- [ ] 订单详情完整
- [ ] 包含用户信息

**结果**: ✅ / ❌

---

### Test 3.2: 充值审核

**操作步骤**:
1. 导航: 充值审核
2. 查看待审核列表

**DevTools验证**:
```
Network → 查找:
  GET /api/v1/billing/admin/recharges
  Status: 200
  Response: {
    data: [
      {id: 1, status: "pending", amount: 100, ...}
    ]
  }
```

**关键验证**:
- [ ] **显示用户提交的充值申请**
- [ ] 状态为"待审核"
- [ ] 金额为100

**操作步骤（批准）**:
1. 点击"批准"按钮
2. 确认

**DevTools验证**:
```
Network → 查找:
  PUT /api/v1/billing/recharge/1/approve
  Status: 200
  Response: {
    message: "充值已批准",
    ...
  }
```

**结果验证**:
- [ ] 批准成功提示
- [ ] 列表中状态更新为"已批准"
- [ ] **切回用户账户，余额增加$100**

**结果**: ✅ / ❌

---

### Test 3.3: 用户管理

**操作步骤**:
1. 导航: 用户管理
2. 查看用户列表

**DevTools验证**:
```
Network → 查找:
  GET /api/v1/admin/users
  Status: 200
  Response: {
    data: [...],
    total: >= 2
  }
```

**关键验证**:
- [ ] 显示所有用户
- [ ] **包含之前注册的testuser**
- [ ] 显示余额变化（购买后减少）
- [ ] 可以修改状态
- [ ] 可以修改角色

**结果**: ✅ / ❌

---

### Test 3.4: 价格配置查询

**操作步骤**:
1. 导航: 价格管理 → 价格配置
2. 查看配置列表

**DevTools验证**:
```
Network → 查找:
  GET /api/v1/price/configs
  Status: 200
  Response: {
    data: [
      {productType: "static-residential", basePrice: 5},
      {productType: "static-residential-native", basePrice: 10}
    ]
  }
```

**关键验证**:
- [ ] 显示2个配置
- [ ] 普通IP: $5
- [ ] 原生IP: $10

**结果**: ✅ / ❌

---

### Test 3.5: 价格覆盖管理

**操作步骤**:
1. 导航: 价格管理 → 价格覆盖管理
2. 查看IP池列表

**DevTools验证**:
```
Network → 查找:
  GET /api/v1/price/ip-pool
  Status: 200
  Response: {
    data: [...],  // 26个地区
    total: 26
  }
```

**关键验证**:
- [ ] 显示26个地区
- [ ] 日本Tokyo显示覆盖价格$10
- [ ] 美国NY显示覆盖价格$1

**操作步骤（修改价格）**:
1. 找到韩国Seoul
2. 修改覆盖价格为 $12
3. 点击"保存所有修改"

**DevTools验证**:
```
Network → 查找:
  POST /api/v1/price/overrides/batch
  Request: {
    updates: [
      {country: "KR", city: "Seoul", ipType: "shared", overridePrice: 12}
    ]
  }
  Status: 200/201
```

**结果**: ✅ / ❌

---

### Test 3.6: 系统统计

**操作步骤**:
1. 导航: 仪表盘
2. 查看统计数据

**DevTools验证**:
```
Network → 查找:
  GET /api/v1/admin/statistics
  Status: 200
  Response: {
    totalUsers: >= 2,
    totalOrders: >= 2,
    totalRevenue: 50,
    ...
  }
```

**关键验证**:
- [ ] 用户数正确
- [ ] 订单数正确
- [ ] 收入统计正确

**结果**: ✅ / ❌

---

## 📋 Phase 4: 数据流验证（15分钟）

### Test 4.1: 用户购买 → 管理员可见

**验证点**:
1. **用户操作**: 购买1个新加坡普通IP（30天，$5）
2. **DevTools**: POST /api/v1/proxy/static/purchase → 200
3. **切换到管理员**:
   - [ ] 订单管理显示新订单
   - [ ] 订单金额$5
   - [ ] 包含用户信息
4. **返回用户**:
   - [ ] 余额减少$5
   - [ ] 订单列表显示
   - [ ] 代理列表显示新IP

**结果**: ✅ / ❌

---

### Test 4.2: 价格修改 → 用户看到

**验证点**:
1. **管理员操作**: 将韩国Seoul普通IP价格改为$12
2. **保存成功**
3. **切换到用户**:
4. **导航**: 静态住宅选购
5. **选择**: 普通IP
6. **DevTools验证**:
   ```
   POST /api/v1/price/calculate
   Response: {
     breakdown: [
       {location: "KR/Seoul", unitPrice: 12}  // 新价格!
     ]
   }
   ```
7. **页面验证**: 韩国Seoul显示 **$12/月**

**结果**: ✅ / ❌

---

### Test 4.3: 充值审核 → 余额更新

**验证点**:
1. **用户**: 提交$200充值申请
2. **管理员**: 批准充值
3. **返回用户**: 
   - [ ] 导航栏余额立即更新 (+$200)
   - [ ] 充值记录状态更新
   - [ ] 交易明细显示充值记录

**结果**: ✅ / ❌

---

## 📊 测试结果汇总

### Phase 1: 认证和基础功能
```
Test 1.1 用户注册:      [ ] ✅ / [ ] ❌
Test 1.2 用户登录:      [ ] ✅ / [ ] ❌
Test 1.3 管理员登录:    [ ] ✅ / [ ] ❌
Test 1.4 Token刷新:     [ ] ✅ / [ ] ❌ / [ ] ⏭️
```

### Phase 2: 核心业务功能
```
Test 2.1 购买普通IP:    [ ] ✅ / [ ] ❌
Test 2.2 购买原生IP:    [ ] ✅ / [ ] ❌
Test 2.3 代理列表:      [ ] ✅ / [ ] ❌
Test 2.4 充值申请:      [ ] ✅ / [ ] ❌
Test 2.5 订单列表:      [ ] ✅ / [ ] ❌
Test 2.6 交易明细:      [ ] ✅ / [ ] ❌
```

### Phase 3: 管理功能
```
Test 3.1 查看所有订单:  [ ] ✅ / [ ] ❌
Test 3.2 充值审核:      [ ] ✅ / [ ] ❌
Test 3.3 用户管理:      [ ] ✅ / [ ] ❌
Test 3.4 价格配置:      [ ] ✅ / [ ] ❌
Test 3.5 价格覆盖:      [ ] ✅ / [ ] ❌
Test 3.6 系统统计:      [ ] ✅ / [ ] ❌
```

### Phase 4: 数据流验证
```
Test 4.1 购买可见:      [ ] ✅ / [ ] ❌
Test 4.2 价格传播:      [ ] ✅ / [ ] ❌
Test 4.3 余额同步:      [ ] ✅ / [ ] ❌
```

**总通过率**: ___/19 = ___%

---

## 🐛 问题记录

| # | 测试项 | 问题描述 | 严重程度 | 截图 | 状态 |
|---|--------|----------|----------|------|------|
| 1 | | | | | |
| 2 | | | | | |

---

## 📝 测试总结

### 通过的功能
-

### 发现的问题
-

### 改进建议
-

---

**测试人员**: ___________  
**测试日期**: 2025-11-04  
**测试环境**: 本地开发环境  
**测试完成时间**: ___________


