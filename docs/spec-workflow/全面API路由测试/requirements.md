# ProxyHub 全面API和路由测试 - 需求文档

**创建日期**: 2025-11-04  
**优先级**: P0 - 核心功能验证  
**预计工时**: 1-2小时  

---

## 📋 测试目标

### 1. 验证所有前后端API对接
确保前端发送的请求能够正确到达后端并得到正确响应

### 2. 验证所有路由配置
确保前端路由正确映射，后端路由正确处理

### 3. 验证用户操作的完整数据流
确保用户界面的操作能在管理后台正确显示

---

## 🎯 测试范围

### 用户端功能（Frontend）

#### 1. 认证模块
- [ ] 用户注册
- [ ] 用户登录
- [ ] 管理员登录
- [ ] Token刷新
- [ ] 个人信息获取

#### 2. 静态代理模块
- [ ] 代理列表查询
- [ ] 代理购买（普通IP）
- [ ] 代理购买（原生IP）
- [ ] 代理备注修改
- [ ] 自动续费设置
- [ ] 库存查询

#### 3. 账单模块
- [ ] 充值申请
- [ ] 充值记录查询
- [ ] 交易明细查询
- [ ] 消费记录查询

#### 4. 订单模块
- [ ] 订单列表查询
- [ ] 订单详情查询

#### 5. 价格模块
- [ ] 价格计算（普通IP）
- [ ] 价格计算（原生IP）
- [ ] 汇率查询

#### 6. 仪表盘模块
- [ ] 概览数据获取
- [ ] 消费趋势查询

### 管理端功能（Admin）

#### 1. 用户管理
- [ ] 用户列表查询
- [ ] 用户状态修改
- [ ] 用户角色修改

#### 2. 订单管理
- [ ] 所有订单查询
- [ ] 订单详情查看

#### 3. 充值审核
- [ ] 待审核列表
- [ ] 充值批准
- [ ] 充值拒绝

#### 4. 价格管理
- [ ] 价格配置查询
- [ ] 价格配置修改
- [ ] 价格覆盖查询
- [ ] 价格覆盖创建
- [ ] 价格覆盖修改
- [ ] 价格覆盖删除
- [ ] IP池列表查询
- [ ] 批量价格覆盖

#### 5. 系统统计
- [ ] 系统统计数据
- [ ] 事件日志查询

---

## 🔄 数据流验证场景

### 场景1: 用户购买IP → 管理员查看订单

**用户操作**:
1. 用户登录
2. 选择静态住宅选购
3. 选择地区和数量
4. 提交订单
5. 支付完成

**预期结果**:
- [ ] 用户余额正确扣除
- [ ] 用户订单列表显示新订单
- [ ] 用户交易明细显示支出记录
- [ ] 用户静态代理列表显示新IP
- [ ] **管理员订单管理显示新订单**
- [ ] **管理员用户管理显示余额变化**

### 场景2: 用户充值 → 管理员审核

**用户操作**:
1. 用户提交充值申请
2. 上传支付凭证

**管理员操作**:
1. 查看待审核充值列表
2. 批准充值

**预期结果**:
- [ ] 用户充值记录状态更新
- [ ] 用户余额增加
- [ ] 交易明细显示充值记录
- [ ] **管理员充值审核列表更新**

### 场景3: 管理员修改价格 → 用户看到新价格

**管理员操作**:
1. 进入价格覆盖管理
2. 修改某地区价格
3. 保存

**用户操作**:
1. 进入静态住宅选购
2. 查看对应地区价格

**预期结果**:
- [ ] **用户看到更新后的价格**
- [ ] 价格计算API返回新价格
- [ ] 购买时使用新价格扣款

---

## 📝 API路由清单

### 认证相关 (`/api/v1/auth`)
```
POST   /register       - 用户注册
POST   /login          - 用户登录  
POST   /admin-login    - 管理员登录
POST   /refresh        - Token刷新
GET    /profile        - 获取个人信息
```

### 用户相关 (`/api/v1/users`)
```
GET    /profile        - 获取用户信息
GET    /me             - 获取当前用户
PUT    /profile        - 更新用户信息
POST   /change-password - 修改密码
POST   /api-key/generate - 生成API Key
POST   /api-key/reset   - 重置API Key
```

### 静态代理 (`/api/v1/proxy/static`)
```
GET    /list           - 代理列表
POST   /purchase       - 购买代理
PUT    /:id/auto-renew - 自动续费
PUT    /:id/remark     - 修改备注
GET    /inventory      - 库存查询
```

### 账单相关 (`/api/v1/billing`)
```
POST   /recharge       - 提交充值
GET    /recharges      - 充值记录
GET    /transactions   - 交易明细
PUT    /recharge/:id/approve - 批准充值（管理员）
GET    /admin/recharges      - 所有充值（管理员）
```

### 订单相关 (`/api/v1/orders`)
```
GET    /               - 订单列表
GET    /:id            - 订单详情
GET    /admin/all      - 所有订单（管理员）
```

### 管理员 (`/api/v1/admin`)
```
GET    /users          - 用户列表
GET    /statistics     - 系统统计
PUT    /users/:id/status - 修改用户状态
PUT    /users/:id/role   - 修改用户角色
GET    /settings       - 系统设置
PUT    /settings/:key  - 更新设置
```

### 仪表盘 (`/api/v1/dashboard`)
```
GET    /overview       - 概览数据
GET    /spending-trend - 消费趋势
```

### 价格相关 (`/api/v1/price`)
```
POST   /calculate      - 价格计算
GET    /exchange-rate  - 汇率查询
GET    /configs        - 价格配置（管理员）
PUT    /configs/:id    - 更新配置（管理员）
GET    /ip-pool        - IP池列表（管理员）
GET    /overrides      - 价格覆盖列表（管理员）
POST   /overrides      - 创建覆盖（管理员）
POST   /overrides/batch - 批量覆盖（管理员）
PUT    /overrides/:id  - 更新覆盖（管理员）
DELETE /overrides/:id  - 删除覆盖（管理员）
POST   /exchange-rate/update - 更新汇率（管理员）
```

### 事件日志 (`/api/v1/event-logs`)
```
GET    /my             - 我的日志
GET    /               - 所有日志（管理员）
```

---

## 🧪 测试方法

### 1. 使用Chrome DevTools

**Network标签**:
- 验证API请求发送
- 验证响应状态码
- 验证请求/响应数据格式

**Console标签**:
- 查看前端日志
- 验证错误处理

**Application标签**:
- 验证Token存储
- 验证用户信息缓存

### 2. 使用Postman/cURL

**直接API测试**:
- 验证端点可访问性
- 验证请求参数验证
- 验证错误响应格式

### 3. 端到端测试

**完整用户流程**:
1. 用户注册/登录
2. 浏览和购买代理
3. 充值申请
4. 查看订单和交易

**管理员流程**:
1. 管理员登录
2. 查看和管理订单
3. 审核充值
4. 管理价格

---

## ✅ 验收标准

### 功能完整性
- [ ] 所有API端点正常响应
- [ ] 所有前端路由正确跳转
- [ ] 所有表单提交成功

### 数据一致性
- [ ] 用户操作在管理后台可见
- [ ] 余额变化实时同步
- [ ] 订单状态正确显示

### 错误处理
- [ ] 无效请求返回适当错误
- [ ] 前端显示友好错误消息
- [ ] 网络错误有重试机制

### 性能要求
- [ ] API响应时间 < 1秒
- [ ] 页面加载时间 < 2秒
- [ ] 无明显卡顿

---

## 📅 测试计划

### Phase 1: 基础功能（30分钟）
- 认证流程
- 用户信息管理
- 基础路由

### Phase 2: 核心业务（45分钟）
- 代理购买
- 订单管理
- 充值流程

### Phase 3: 管理功能（30分钟）
- 价格管理
- 用户管理
- 审核流程

### Phase 4: 数据流验证（15分钟）
- 用户→管理员数据流
- 价格更新传播
- 余额同步

**总计**: 约2小时

---

**文档创建时间**: 2025-11-04  
**下一步**: 创建测试设计方案和执行指南


