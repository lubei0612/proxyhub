# 📋 ProxyHub 需求整理 - 2025-11-07

## 🎯 当前阶段：需求讨论

**优先级**: P0 - 数据准确性（去除硬编码和模拟数据）

---

## 一、静态IP管理页面改进

### 当前状态
查看现有代码 `frontend/src/views/proxy/StaticManage.vue`：
- ✅ 已有：IP、端口、账号密码、到期时间、操作
- ❌ 缺少：国家、城市、所属通道、释放时间、节点ID

### 需求：参照985Proxy界面
根据用户截图，需要显示字段：

```
表格列（从左到右）：
1. 所属通道 (channel)
2. IP:端口:账号:密码 (合并显示，可复制)
3. 国家 (country) - 🇺🇸 带国旗
4. 到期时间 (expiresAt)
5. 释放时间 (releaseTime)
6. 节点ID (nodeId)
7. 备注 (remark)
8. 操作 (续费、删除等)
```

**数据来源**：
- 所有数据必须来自985Proxy API
- 不能有硬编码或假数据

---

## 二、购买流程优化

### 当前问题
- 用户点击购买后没有进度提示
- 不知道是否成功
- 看不到购买状态

### 改进方案

**购买按钮点击后：**

```
步骤1: 显示 Loading
┌────────────────────────────────┐
│   🔄 正在连接985Proxy...        │
└────────────────────────────────┘

步骤2: API调用中
┌────────────────────────────────┐
│   🔄 正在分配IP，请稍候...      │
│   预计需要 5-10秒               │
└────────────────────────────────┘

步骤3: 成功提示
┌────────────────────────────────┐
│   ✅ 购买成功！                 │
│                                 │
│   已为您分配IP：                │
│   IP: 45.197.6.165             │
│   端口: 7778                    │
│   国家: 美国 - 洛杉矶           │
│   到期: 2025-12-07             │
│                                 │
│   [复制代理信息] [查看我的IP]   │
└────────────────────────────────┘

步骤4: 失败处理
┌────────────────────────────────┐
│   ❌ 购买失败                   │
│                                 │
│   原因：库存不足                │
│   或：余额不足                  │
│   或：985Proxy服务暂时不可用    │
│                                 │
│   [重试] [联系客服]             │
└────────────────────────────────┘
```

**实现要点**：
1. 使用 Loading 组件显示进度
2. API调用时显示友好提示
3. 成功后立即显示IP详情
4. 失败时给出明确原因和解决方案

---

## 三、充值流程优化

### 当前问题
- 充值提交后不知道状态
- 不清楚等待时间
- 没有进度显示

### 改进方案

**充值申请页面：**

```
提交充值申请
┌────────────────────────────────┐
│ 充值金额：$100                  │
│ 充值方式：支付宝                │
│                                 │
│ ⏱ 预计到账时间：                │
│    人工审核：1-24小时内         │
│    工作时间：通常1小时内        │
│                                 │
│ [提交申请]                      │
└────────────────────────────────┘
```

**提交后显示：**

```
充值订单详情
┌────────────────────────────────┐
│ 订单号：RCH20251107001          │
│                                 │
│ 状态：⏳ 等待审核               │
│                                 │
│ 提交时间：2025-11-07 10:30      │
│ 充值金额：$100                  │
│ 充值方式：支付宝                │
│                                 │
│ 💡 请联系客服加快审核：          │
│ Telegram: @support1             │
│ Telegram: @support2             │
│                                 │
│ [返回充值页] [查看充值记录]     │
└────────────────────────────────┘
```

**充值记录页面状态显示：**

```
状态图标和文字：
⏳ 等待审核      (pending)
👀 审核中        (reviewing)
✅ 审核通过      (approved)
❌ 审核拒绝      (rejected) - 显示原因

操作按钮：
- 等待审核：[催单] [取消申请]
- 审核中：[查看详情]
- 已通过：[查看详情]
- 已拒绝：[查看原因] [重新申请]
```

---

## 四、管理后台新增功能

### 1. 用户余额扣除功能

**场景**：管理员不小心批准了错误的充值金额

**当前**：
- ✅ 只有"赠送余额"功能
- ❌ 无法扣除余额

**新增**：

```
用户管理 - 操作菜单
┌────────────────────────────────┐
│ 用户：user@example.com          │
│ 当前余额：$100.00               │
│                                 │
│ [赠送余额] [扣除余额] [详情]    │
└────────────────────────────────┘

点击"扣除余额"弹窗：
┌────────────────────────────────┐
│ 扣除余额                         │
│                                 │
│ 用户邮箱：user@example.com      │
│ 当前余额：$100.00               │
│                                 │
│ 扣除金额：[______] USD          │
│ 扣除原因：[______________]      │
│           (必填，记录日志)       │
│                                 │
│ 扣除后余额：$XX.XX              │
│                                 │
│ ⚠️ 此操作不可撤销                │
│                                 │
│ [取消] [确认扣除]               │
└────────────────────────────────┘
```

**实现要点**：
1. 扣除金额不能超过当前余额
2. 必须填写扣除原因（记录到事件日志）
3. 扣除操作写入交易记录
4. 扣除后发送通知给用户

---

### 2. 后台添加用户功能

**场景**：VIP客户，提前创建好账户并充值，提供完善的服务

**需求**：

```
管理后台 - 用户管理
[添加用户] 按钮

点击后弹窗：
┌────────────────────────────────┐
│ 创建新用户                       │
│                                 │
│ 邮箱：[______________]          │
│       (必填，用于登录)           │
│                                 │
│ 初始密码：[______________]      │
│       (必填，可后续修改)         │
│                                 │
│ 昵称：[______________]          │
│       (可选)                    │
│                                 │
│ 初始余额：[______] USD          │
│       (可选，默认$0)             │
│                                 │
│ 备注：[______________]          │
│       (VIP客户、推荐人等)        │
│                                 │
│ 📧 是否发送欢迎邮件？            │
│ ☑️ 发送（包含账号和初始密码）    │
│                                 │
│ [取消] [创建用户]               │
└────────────────────────────────┘
```

**创建流程**：
1. 管理员填写信息
2. 点击"创建用户"
3. 系统：
   - 在数据库创建用户记录
   - 密码加密存储（bcrypt）
   - 如果设置了初始余额，创建充值记录
   - 如果勾选发送邮件，发送欢迎邮件
4. 创建成功提示，显示账号信息

**用户体验提升**：
```
欢迎邮件内容：
─────────────────────────────
欢迎使用 ProxyHub！

您的账户已创建：
邮箱：user@example.com
初始密码：xxxx****

登录地址：https://proxyhub.com

当前余额：$100.00
立即登录开始使用！

如有问题请联系客服：
Telegram: @support1
─────────────────────────────
```

---

## 五、硬编码和模拟数据检查

### 已发现的文件（需要检查）

**后端**：
1. `backend/src/database/seed-test-data.sql` - 测试数据SQL
2. `backend/src/modules/proxy/static/static-proxy.service.ts` - 静态代理服务
3. `backend/src/modules/admin/clean-mock.controller.ts` - 清理Mock数据控制器
4. `backend/src/modules/proxy/dynamic/services/dynamic-usage.service.ts` - 动态代理使用服务

**前端**：
- 需要检查 Vue 组件中是否有硬编码数据

### 需要检查的内容

**1. 硬编码IP地址**：
```typescript
// ❌ 错误示例
const mockIPs = [
  { ip: '123.45.67.89', port: 8080 },
  { ip: '198.51.100.1', port: 8080 }
];
```

**2. 硬编码价格**：
```typescript
// ❌ 错误示例
const basePrice = 2.5;
const premiumPrice = 5.0;
```

**3. 假的订单数据**：
```sql
-- ❌ 错误示例
INSERT INTO orders (user_id, type, amount, status)
VALUES (1, 'purchase', 17.5, 'completed');
```

**4. 测试用户数据**：
```sql
-- ✅ 这个可以保留（用于初始化管理员）
INSERT INTO users (email, password, role)
VALUES ('admin@example.com', 'hash...', 'admin');

-- ❌ 这些应该删除
INSERT INTO users (email, password, role)
VALUES 
  ('test1@test.com', 'hash...', 'user'),
  ('test2@test.com', 'hash...', 'user');
```

**5. 假的静态IP记录**：
```sql
-- ❌ 错误示例
INSERT INTO static_proxies (ip, port, user_id, country_code)
VALUES ('45.197.6.165', 7778, 1, 'US');
```

---

## 六、开发习惯补充

### UI设计文字描述规范

**在开发每个功能前，先用文字描述UI**：

```
功能：充值申请
页面：账户充值

布局：
┌─────────────────────────────────────┐
│ 标题：账户充值                       │
├─────────────────────────────────────┤
│                                      │
│ 1. 选择充值金额（卡片式）             │
│    [$50] [$100] [$200] [$500]       │
│                                      │
│ 2. 或自定义金额                      │
│    [输入框] USD                      │
│                                      │
│ 3. 选择充值方式                      │
│    ⚪ 银行转账                       │
│    ⚪ 支付宝                         │
│    ⚪ 微信支付                       │
│                                      │
│ 4. 联系方式                          │
│    Telegram: @support1 | @support2  │
│                                      │
│ [提交充值申请]                       │
└─────────────────────────────────────┘

交互流程：
1. 用户选择或输入金额
2. 选择充值方式
3. 点击"提交充值申请"
4. 弹出提示"申请已提交，请联系客服"
5. 显示订单号和充值说明

数据流：
前端 → POST /api/v1/billing/recharge
      { amount: 100, method: 'alipay' }
后端 → 创建充值订单
      → 返回订单详情
前端 → 显示订单信息和联系方式
```

### 用户体验关注点

**站在用户角度思考**：
1. **清晰度**：用户能立刻明白这个页面是干什么的吗？
2. **简单性**：操作步骤是否简单直接？
3. **反馈性**：用户操作后有明确反馈吗？
4. **容错性**：用户操作错误时，系统友好提示了吗？
5. **效率性**：用户能快速完成任务吗？

**高端客户服务体验**：
- 提前创建好账户
- 充值好余额
- 发送欢迎邮件
- 客户登录即可使用
- 感受到"尊贵"和"贴心"

---

## 七、下一步行动计划

### Phase 1: 检查和清理（2-3小时）

1. **检查所有硬编码和模拟数据**
   - 阅读上述5个文件
   - 列出所有需要清理的地方
   - 制定清理计划

2. **确认数据来源**
   - 哪些数据来自985Proxy API？
   - 哪些是硬编码的？
   - 哪些是测试数据？

### Phase 2: 实施清理（4-6小时）

1. **删除测试数据**
   - 清理 seed-test-data.sql 中的假IP
   - 清理假订单
   - 保留必要的管理员账户

2. **移除硬编码**
   - 价格从数据库/API获取
   - IP信息从985Proxy API获取
   - 库存从985Proxy API获取

3. **验证数据一致性**
   - 用Chrome DevTools验证
   - 对比ProxyHub和985Proxy官网
   - 确保100%一致

### Phase 3: 功能优化（6-8小时）

1. **静态IP管理页面**
   - 添加缺失字段
   - 参照985Proxy界面
   - 优化显示效果

2. **购买流程优化**
   - 添加进度提示
   - 优化成功/失败反馈
   - 提升用户体验

3. **充值流程优化**
   - 状态显示
   - 时间预期
   - 实时更新

4. **管理后台新功能**
   - 扣除余额功能
   - 添加用户功能
   - 完善服务体验

---

## 八、需要确认的问题

1. **数据库中现在有多少条静态IP记录？**
   - 这些是真实的还是测试的？

2. **用户购买IP后，是否立即调用985Proxy API？**
   - 还是只是创建订单记录？

3. **价格配置表（price_configs）的数据来源？**
   - 是手动设置的还是从985Proxy同步的？

4. **当前是否有真实用户在使用？**
   - 清理数据会不会影响他们？

---

**准备好后告诉我，我们开始执行清理和优化！** 🚀

