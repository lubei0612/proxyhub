# 数据一致性修复需求

## 1. 问题概述

用户报告系统存在多处数据不一致和功能问题，需要全面排查和修复。

## 2. 核心问题列表

### 2.1 数据一致性问题（P0 - 严重）

#### 仪表盘数据不一致
- 总代理数显示20
- 活跃代理显示31
- 总订单数显示$100（应该是数字不是金额）
- 这些数据不匹配，怀疑是写死的数据

#### 管理后台数据异常
- 普通用户显示680个（实际只有6-7个用户）
- 总收入$500（实际收入不应该这么多）
- 总订单数38（需要验证）
- 代理IP总数30（需要验证）
- 今天购买了IP但没有显示增加

#### 流量数据异常
- 用户没有使用流量，但图表显示有数据
- 网络使用流量概况显示数据
- 网络请求分布显示数据
- 使用流量折线图显示数据

### 2.2 功能问题（P0 - 严重）

#### 事件日志筛选未生效
- 点击事件类型筛选没有反应
- 筛选功能不工作

#### 静态住宅管理
- 之前修复后需要验证是否正常显示IP列表

### 2.3 数据来源问题（P1 - 重要）

#### 需要确认的功能模块
- 订单管理 - 数据一致性
- 交易明细 - 数据一致性
- 结算记录 - 数据一致性
- 充值订单 - 数据一致性
- 用户管理 - 所有功能是否正常
- 价格覆盖管理 - IP池是否来自985proxy

## 3. 用户期望

### 3.1 数据准确性
- 所有统计数据必须基于真实数据库数据
- 不能有任何写死的假数据
- 实时反映当前系统状态

### 3.2 功能完整性
- 所有筛选功能必须正常工作
- 所有统计图表必须显示真实数据
- 用户操作后数据必须立即更新

### 3.3 专业性
- 客户使用时不能发现任何问题
- 数据必须完全一致
- 功能必须完全可用

## 4. 验收标准

### 4.1 仪表盘数据
- [ ] 总代理数 = 数据库中用户的静态IP总数
- [ ] 活跃代理 = 状态为active的IP数量
- [ ] 总订单数 = 数据库中订单总数（数字而非金额）
- [ ] 总消费 = 用户实际消费金额
- [ ] 今日购买IP后统计立即更新

### 4.2 管理后台数据
- [ ] 普通用户数 = role为'user'的用户数量
- [ ] 总收入 = 所有已完成订单的总金额
- [ ] 总订单数 = 数据库中订单总数
- [ ] 代理IP总数 = 数据库中IP总数
- [ ] 数据实时更新

### 4.3 流量统计
- [ ] 无流量使用时图表显示0或空
- [ ] 有流量使用时显示真实数据
- [ ] 所有时间基于UTC正确计算

### 4.4 筛选功能
- [ ] 事件日志类型筛选正常工作
- [ ] 所有筛选器都能正常过滤数据

### 4.5 数据一致性
- [ ] 订单管理、交易明细、结算记录数据一致
- [ ] 各模块统计数据互相匹配
- [ ] 用户管理功能完全正常

## 5. 测试方法

使用Chrome DevTools MCP进行以下测试：
1. 仪表盘数据验证
2. 管理后台统计验证
3. 事件日志筛选测试
4. 静态IP列表显示测试
5. 订单和交易数据一致性测试
6. 用户管理功能测试
7. 价格覆盖管理测试

## 6. 优先级

- P0: 数据不一致问题、写死数据问题
- P1: 筛选功能问题
- P2: UI优化和体验改进

