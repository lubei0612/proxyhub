# UI修复和API改进 - 需求文档

## 1. 功能概述

### 1.1 背景
ProxyHub系统当前存在多个UI渲染问题、API连接问题和硬编码数据问题，影响用户体验和系统功能完整性。本次改进旨在全面修复这些问题，提升系统质量。

### 1.2 目标
- 修复所有P0级API连接问题
- 重构账户中心UI为左右布局
- 修复仪表盘卡片渲染问题
- 实现数据动态化（移除硬编码）
- 完善移动端响应式设计

### 1.3 范围
**包含：**
- 985Proxy API连接修复
- 价格覆盖API端点修复
- 账户中心页面重构
- 仪表盘UI修复
- 待处理事项数据动态化
- 移动端响应式改进

**不包含：**
- 新功能开发
- 数据库结构变更
- 第三方服务集成（已有的除外）

---

## 2. 用户故事

### 2.1 P0 - 关键功能修复

#### US-001: 985Proxy API连接修复
**作为** 系统管理员  
**我想要** 系统能正常连接985Proxy API  
**以便于** 获取IP库存、业务场景等数据

**验收标准：**
- [ ] API KEY配置正确且有效
- [ ] 所有985Proxy相关API调用成功返回200
- [ ] 静态住宅选购页面能正常加载库存数据
- [ ] 业务场景下拉框能正常显示选项
- [ ] 控制台不再显示400错误

**EARS场景：**
```
WHEN 用户访问静态住宅选购页面
AND 页面初始化加载数据
THEN 系统应成功调用985Proxy API
AND 返回有效的库存和业务场景数据
AND 不显示任何API错误提示
```

---

#### US-002: 价格覆盖功能API修复
**作为** 系统管理员  
**我想要** 在用户管理中为单个用户设置价格覆盖  
**以便于** 为不同用户提供个性化定价

**验收标准：**
- [ ] 点击"价格覆盖"按钮能成功打开对话框
- [ ] 对话框能成功加载用户的IP池数据
- [ ] API端点 `GET /api/v1/price/user-ip-pool/:userId` 正常工作
- [ ] API端点 `POST /api/v1/price/user-overrides/:userId/batch` 正常工作
- [ ] 保存价格覆盖后能即时生效
- [ ] 不显示"无法获取用户价格信息"错误

**EARS场景：**
```
GIVEN 管理员在用户管理页面
WHEN 点击某个用户的"价格覆盖"按钮
THEN 系统应打开价格覆盖对话框
AND 成功加载该用户的IP池数据
AND 允许管理员修改价格
AND 保存后立即生效
```

---

### 2.2 P1 - UI/UX改进

#### US-003: 账户中心页面重构
**作为** 普通用户  
**我想要** 在账户中心看到清晰的左右布局  
**以便于** 快速找到账户信息和常用操作

**验收标准：**
- [ ] 页面采用左右分栏布局（60% + 40%）
- [ ] 左侧显示：登录密码、邮箱绑定、通知设置等账户信息
- [ ] 右侧显示：快捷操作卡片 + 联系客服卡片
- [ ] 快捷操作包含：订购静态IP、动态代理管理、静态IP管理、查看订单
- [ ] 联系客服显示：客服信息、工作时间、平均响应时间
- [ ] 移动端自动调整为上下布局

**EARS场景：**
```
WHEN 用户访问"我的账户" -> "账户中心"页面
THEN 系统应显示左右分栏布局
WHERE 左侧60%显示账户信息
AND 右侧40%显示快捷操作和客服信息
IF 设备宽度 < 768px THEN 自动切换为上下布局
```

**UI设计规范：**
```
┌─────────────────────────────────────────────────────┐
│  账户中心                                  [修改密码]  │
├───────────────────────┬─────────────────────────────┤
│  【左侧 60%】          │  【右侧 40%】                │
│                       │                             │
│  📱 登录密码          │  🚀 快捷操作                 │
│  ✉️ 邮箱绑定          │  - 订购静态IP                │
│  🔔 通知设置          │  - 动态代理管理              │
│                       │  - 静态IP管理                │
│                       │  - 查看订单                  │
│                       │                             │
│                       │  💬 联系客服                 │
│                       │  - 客服信息                  │
│                       │  - 工作时间                  │
│                       │  - 响应时间                  │
└───────────────────────┴─────────────────────────────┘
```

---

#### US-004: 仪表盘卡片渲染修复
**作为** 用户  
**我想要** 仪表盘顶部的统计卡片正常显示  
**以便于** 快速了解系统概况

**验收标准：**
- [ ] 4个统计卡片完整显示（总代理数、活跃代理、总订单数、总消费）
- [ ] 卡片宽度正确，不会被截断
- [ ] 卡片图标和文字对齐正常
- [ ] 数字和标签清晰可读
- [ ] 响应式布局正常（移动端2列显示）

**EARS场景：**
```
WHEN 用户访问仪表盘页面
THEN 顶部应显示4个统计卡片
AND 每个卡片完整可见
AND 卡片内容正确对齐
AND 文字清晰可读
IF 设备宽度 < 768px THEN 卡片2列显示
```

---

#### US-005: 待处理事项数据动态化
**作为** 系统管理员  
**我想要** 看到真实的待处理事项数量  
**以便于** 及时处理需要审核的业务

**验收标准：**
- [ ] 移除硬编码的数字"3"
- [ ] 充值审核数量从数据库实时查询
- [ ] 异常订单数量从数据库实时查询
- [ ] 系统通知数量从数据库实时查询
- [ ] 数字为0时显示"0"而不是隐藏
- [ ] 点击各项能跳转到对应页面

**EARS场景：**
```
WHEN 管理员打开管理后台
THEN 系统应查询数据库获取待处理事项
AND 显示真实的充值审核数量
AND 显示真实的异常订单数量
AND 显示真实的系统通知数量
AND 总数应为以上三项之和
```

---

#### US-006: 移动端响应式完善
**作为** 移动端用户  
**我想要** 所有页面在手机上正常显示  
**以便于** 随时随地管理代理服务

**验收标准：**
- [ ] 账户中心页面移动端布局正常
- [ ] 仪表盘图表在移动端可正常滚动
- [ ] 价格覆盖对话框在移动端尺寸合适
- [ ] 表格在移动端支持横向滚动
- [ ] 按钮和输入框在移动端大小合适（最小44px）
- [ ] 文字在移动端可读（最小14px）

**EARS场景：**
```
GIVEN 用户使用移动设备访问系统
WHEN 浏览任意页面
THEN 所有元素应适应屏幕宽度
AND 文字清晰可读（≥14px）
AND 按钮易于点击（≥44px）
AND 表格支持横向滚动
AND 图表自适应容器宽度
```

---

## 3. 非功能需求

### 3.1 性能要求
- API响应时间 < 2秒
- 页面首次加载时间 < 3秒
- UI渲染无明显卡顿

### 3.2 兼容性要求
- 桌面端：Chrome 90+、Firefox 88+、Safari 14+、Edge 90+
- 移动端：iOS Safari 14+、Android Chrome 90+
- 屏幕尺寸：320px ~ 3840px

### 3.3 可用性要求
- 错误提示清晰明确
- 加载状态有明确指示
- 操作有即时反馈

### 3.4 可维护性要求
- 代码遵循项目现有规范
- 组件高度复用
- 注释清晰完整

---

## 4. 约束条件

### 4.1 技术约束
- 必须使用Vue 3 + TypeScript
- 必须使用Element Plus UI组件库
- 必须保持与现有架构一致

### 4.2 业务约束
- 不改变现有业务逻辑
- 不影响现有功能正常使用
- 向下兼容现有数据

### 4.3 时间约束
- 预计开发时间：2-3小时
- 测试和修复时间：1小时

---

## 5. 依赖关系

### 5.1 外部依赖
- 985Proxy API服务正常
- 数据库服务正常
- Redis缓存服务正常

### 5.2 内部依赖
- 现有的认证授权模块
- 现有的价格管理模块
- 现有的订单管理模块

---

## 6. 风险评估

### 6.1 技术风险
| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| 985Proxy API不稳定 | 高 | 中 | 添加重试机制和降级处理 |
| 价格覆盖逻辑复杂 | 中 | 低 | 完善测试覆盖 |
| 响应式适配兼容性 | 中 | 中 | 多设备测试 |

### 6.2 业务风险
| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| 影响现有功能 | 高 | 低 | 回归测试 |
| 数据不一致 | 中 | 低 | 数据验证 |

---

## 7. 成功标准

### 7.1 功能完整性
- ✅ 所有P0问题已修复
- ✅ 所有P1问题已修复
- ✅ 所有验收标准通过

### 7.2 代码质量
- ✅ 无TypeScript编译错误
- ✅ 无ESLint警告
- ✅ 代码审查通过

### 7.3 用户验收
- ✅ 用户测试反馈良好
- ✅ 无遗留严重问题

---

## 8. 附录

### 8.1 术语表
- **P0**: 最高优先级，阻塞性问题
- **P1**: 高优先级，严重影响用户体验
- **EARS**: Event-Action-Result-State，需求描述方法

### 8.2 参考资料
- Element Plus文档: https://element-plus.org/
- Vue 3响应式设计最佳实践
- 移动端适配规范



