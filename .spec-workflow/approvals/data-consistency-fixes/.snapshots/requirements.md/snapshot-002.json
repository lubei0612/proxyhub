{
  "id": "snapshot_1762745936557_pthi1je7d",
  "approvalId": "approval_1762409611216_9vntour85",
  "approvalTitle": "数据一致性修复需求文档",
  "version": 2,
  "timestamp": "2025-11-10T03:38:56.557Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# 数据一致性修复需求\r\n\r\n## 1. 问题概述\r\n\r\n用户报告系统存在多处数据不一致和功能问题，需要全面排查和修复。\r\n\r\n## 2. 核心问题列表\r\n\r\n### 2.1 数据一致性问题（P0 - 严重）\r\n\r\n#### 仪表盘数据不一致\r\n- 总代理数显示20\r\n- 活跃代理显示31\r\n- 总订单数显示$100（应该是数字不是金额）\r\n- 这些数据不匹配，怀疑是写死的数据\r\n\r\n#### 管理后台数据异常\r\n- 普通用户显示680个（实际只有6-7个用户）\r\n- 总收入$500（实际收入不应该这么多）\r\n- 总订单数38（需要验证）\r\n- 代理IP总数30（需要验证）\r\n- 今天购买了IP但没有显示增加\r\n\r\n#### 流量数据异常\r\n- 用户没有使用流量，但图表显示有数据\r\n- 网络使用流量概况显示数据\r\n- 网络请求分布显示数据\r\n- 使用流量折线图显示数据\r\n\r\n### 2.2 功能问题（P0 - 严重）\r\n\r\n#### 事件日志筛选未生效\r\n- 点击事件类型筛选没有反应\r\n- 筛选功能不工作\r\n\r\n#### 静态住宅管理\r\n- 之前修复后需要验证是否正常显示IP列表\r\n\r\n### 2.3 数据来源问题（P1 - 重要）\r\n\r\n#### 需要确认的功能模块\r\n- 订单管理 - 数据一致性\r\n- 交易明细 - 数据一致性\r\n- 结算记录 - 数据一致性\r\n- 充值订单 - 数据一致性\r\n- 用户管理 - 所有功能是否正常\r\n- 价格覆盖管理 - IP池是否来自985proxy\r\n\r\n## 3. 用户期望\r\n\r\n### 3.1 数据准确性\r\n- 所有统计数据必须基于真实数据库数据\r\n- 不能有任何写死的假数据\r\n- 实时反映当前系统状态\r\n\r\n### 3.2 功能完整性\r\n- 所有筛选功能必须正常工作\r\n- 所有统计图表必须显示真实数据\r\n- 用户操作后数据必须立即更新\r\n\r\n### 3.3 专业性\r\n- 客户使用时不能发现任何问题\r\n- 数据必须完全一致\r\n- 功能必须完全可用\r\n\r\n## 4. 验收标准\r\n\r\n### 4.1 仪表盘数据\r\n- [ ] 总代理数 = 数据库中用户的静态IP总数\r\n- [ ] 活跃代理 = 状态为active的IP数量\r\n- [ ] 总订单数 = 数据库中订单总数（数字而非金额）\r\n- [ ] 总消费 = 用户实际消费金额\r\n- [ ] 今日购买IP后统计立即更新\r\n\r\n### 4.2 管理后台数据\r\n- [ ] 普通用户数 = role为'user'的用户数量\r\n- [ ] 总收入 = 所有已完成订单的总金额\r\n- [ ] 总订单数 = 数据库中订单总数\r\n- [ ] 代理IP总数 = 数据库中IP总数\r\n- [ ] 数据实时更新\r\n\r\n### 4.3 流量统计\r\n- [ ] 无流量使用时图表显示0或空\r\n- [ ] 有流量使用时显示真实数据\r\n- [ ] 所有时间基于UTC正确计算\r\n\r\n### 4.4 筛选功能\r\n- [ ] 事件日志类型筛选正常工作\r\n- [ ] 所有筛选器都能正常过滤数据\r\n\r\n### 4.5 数据一致性\r\n- [ ] 订单管理、交易明细、结算记录数据一致\r\n- [ ] 各模块统计数据互相匹配\r\n- [ ] 用户管理功能完全正常\r\n\r\n## 5. 测试方法\r\n\r\n使用Chrome DevTools MCP进行以下测试：\r\n1. 仪表盘数据验证\r\n2. 管理后台统计验证\r\n3. 事件日志筛选测试\r\n4. 静态IP列表显示测试\r\n5. 订单和交易数据一致性测试\r\n6. 用户管理功能测试\r\n7. 价格覆盖管理测试\r\n\r\n## 6. 优先级\r\n\r\n- P0: 数据不一致问题、写死数据问题\r\n- P1: 筛选功能问题\r\n- P2: UI优化和体验改进\r\n\r\n",
  "fileStats": {
    "size": 3284,
    "lines": 113,
    "lastModified": "2025-11-06T06:30:00.410Z"
  },
  "comments": []
}