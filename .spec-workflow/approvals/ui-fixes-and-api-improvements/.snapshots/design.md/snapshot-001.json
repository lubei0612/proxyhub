{
  "id": "snapshot_1762757320119_ktwawp7nr",
  "approvalId": "approval_1762757320091_7o89fswkh",
  "approvalTitle": "UIä¿®å¤å’ŒAPIæ”¹è¿› - è®¾è®¡æ–‡æ¡£",
  "version": 1,
  "timestamp": "2025-11-10T06:48:40.119Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# UIä¿®å¤å’ŒAPIæ”¹è¿› - è®¾è®¡æ–‡æ¡£\r\n\r\n## 1. ç³»ç»Ÿæ¶æ„\r\n\r\n### 1.1 æ•´ä½“æ¶æ„\r\n```\r\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\r\nâ”‚                    Frontend (Vue 3)                      â”‚\r\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\r\nâ”‚  â”‚ AccountCenterâ”‚  â”‚  Dashboard   â”‚  â”‚ UserManage   â”‚  â”‚\r\nâ”‚  â”‚    Page      â”‚  â”‚    Page      â”‚  â”‚    Page      â”‚  â”‚\r\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\r\nâ”‚         â”‚                 â”‚                 â”‚           â”‚\r\nâ”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚\r\nâ”‚                           â”‚                             â”‚\r\nâ”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                     â”‚\r\nâ”‚                    â”‚  API Client  â”‚                     â”‚\r\nâ”‚                    â”‚  (Axios)     â”‚                     â”‚\r\nâ”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚\r\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\r\n                            â”‚ HTTP/REST\r\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\r\nâ”‚                    Backend (NestJS)                      â”‚\r\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\r\nâ”‚  â”‚   Pricing    â”‚  â”‚   Proxy985   â”‚  â”‚    Stats     â”‚  â”‚\r\nâ”‚  â”‚   Module     â”‚  â”‚    Module    â”‚  â”‚   Module     â”‚  â”‚\r\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\r\nâ”‚         â”‚                 â”‚                 â”‚           â”‚\r\nâ”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚\r\nâ”‚                           â”‚                             â”‚\r\nâ”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚\r\nâ”‚         â”‚                 â”‚                 â”‚           â”‚\r\nâ”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”‚\r\nâ”‚    â”‚  TypeORMâ”‚      â”‚  Axios    â”‚    â”‚  Redis    â”‚     â”‚\r\nâ”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚\r\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\r\n          â”‚                  â”‚\r\n    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”\r\n    â”‚PostgreSQL â”‚     â”‚985Proxy API â”‚\r\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\r\n```\r\n\r\n### 1.2 æ ¸å¿ƒæ¨¡å—\r\n\r\n#### å‰ç«¯æ¨¡å—\r\n| æ¨¡å— | æ–‡ä»¶è·¯å¾„ | èŒè´£ |\r\n|------|---------|------|\r\n| AccountCenter | `frontend/src/views/account/AccountCenter.vue` | è´¦æˆ·ä¸­å¿ƒé¡µé¢UI |\r\n| Dashboard | `frontend/src/views/Dashboard.vue` | ä»ªè¡¨ç›˜ç»Ÿè®¡å¡ç‰‡ |\r\n| UserManagement | `frontend/src/views/admin/Users.vue` | ç”¨æˆ·ç®¡ç†å’Œä»·æ ¼è¦†ç›– |\r\n| UserPriceOverrideModal | `frontend/src/components/UserPriceOverrideModal.vue` | ä»·æ ¼è¦†ç›–å¯¹è¯æ¡† |\r\n| StaticBuy | `frontend/src/views/proxy/StaticBuy.vue` | é™æ€ä»£ç†è´­ä¹°é¡µé¢ |\r\n\r\n#### åç«¯æ¨¡å—\r\n| æ¨¡å— | æ–‡ä»¶è·¯å¾„ | èŒè´£ |\r\n|------|---------|------|\r\n| PricingModule | `backend/src/modules/pricing/` | ä»·æ ¼ç®¡ç†å’Œè¦†ç›– |\r\n| Proxy985Module | `backend/src/modules/proxy985/` | 985APIé›†æˆ |\r\n| StatsModule | `backend/src/modules/stats/` | ç»Ÿè®¡æ•°æ®æŸ¥è¯¢ |\r\n| OrderModule | `backend/src/modules/order/` | è®¢å•å’Œå……å€¼å®¡æ ¸ |\r\n\r\n---\r\n\r\n## 2. æ•°æ®åº“è®¾è®¡\r\n\r\n### 2.1 ç›¸å…³è¡¨ç»“æ„\r\n\r\n#### price_overrides è¡¨ï¼ˆå·²å­˜åœ¨ï¼‰\r\n```sql\r\nCREATE TABLE price_overrides (\r\n  id SERIAL PRIMARY KEY,\r\n  country VARCHAR(100) NOT NULL,\r\n  city VARCHAR(100) NOT NULL,\r\n  ip_type VARCHAR(50) NOT NULL,\r\n  override_price DECIMAL(10,2) NOT NULL,\r\n  user_id INTEGER NULL,  -- NULL = å…¨å±€è¦†ç›–ï¼ŒéNULL = ç”¨æˆ·ç‰¹å®šè¦†ç›–\r\n  created_at TIMESTAMP DEFAULT NOW(),\r\n  updated_at TIMESTAMP DEFAULT NOW(),\r\n  UNIQUE(country, city, ip_type, COALESCE(user_id, 0))\r\n);\r\n\r\nCREATE INDEX idx_price_overrides_user_id ON price_overrides(user_id);\r\nCREATE INDEX idx_price_overrides_global ON price_overrides(user_id) WHERE user_id IS NULL;\r\n```\r\n\r\n#### recharge_orders è¡¨ï¼ˆå·²å­˜åœ¨ï¼‰\r\n```sql\r\nCREATE TABLE recharge_orders (\r\n  -- ... existing columns\r\n  status VARCHAR(20) DEFAULT 'pending',  -- pending/approved/rejected\r\n  -- ...\r\n);\r\n```\r\n\r\n---\r\n\r\n## 3. APIæ¥å£è®¾è®¡\r\n\r\n### 3.1 ä»·æ ¼è¦†ç›–ç›¸å…³API\r\n\r\n#### GET /api/v1/price/user-ip-pool/:userId\r\n**æè¿°ï¼š** è·å–ç”¨æˆ·çº§åˆ«çš„IPæ± å’Œä»·æ ¼è¦†ç›–ä¿¡æ¯\r\n\r\n**è¯·æ±‚å‚æ•°ï¼š**\r\n```typescript\r\nparams: {\r\n  userId: number  // ç”¨æˆ·ID\r\n}\r\n```\r\n\r\n**å“åº”ç¤ºä¾‹ï¼š**\r\n```json\r\n{\r\n  \"success\": true,\r\n  \"data\": [\r\n    {\r\n      \"country\": \"ç¾å›½\",\r\n      \"city\": \"æ´›æ‰çŸ¶\",\r\n      \"ipType\": \"shared\",\r\n      \"originalPrice\": 5.99,\r\n      \"globalOverridePrice\": null,\r\n      \"userOverridePrice\": 4.99,\r\n      \"currentPrice\": 4.99,\r\n      \"hasUserOverride\": true\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n#### POST /api/v1/price/user-overrides/:userId/batch\r\n**æè¿°ï¼š** æ‰¹é‡æ›´æ–°ç”¨æˆ·ä»·æ ¼è¦†ç›–\r\n\r\n**è¯·æ±‚å‚æ•°ï¼š**\r\n```typescript\r\nparams: {\r\n  userId: number\r\n}\r\nbody: {\r\n  updates: Array<{\r\n    country: string;\r\n    city: string;\r\n    ipType: string;\r\n    overridePrice: number | null;  // nullè¡¨ç¤ºåˆ é™¤è¦†ç›–\r\n  }>\r\n}\r\n```\r\n\r\n**å“åº”ç¤ºä¾‹ï¼š**\r\n```json\r\n{\r\n  \"success\": true,\r\n  \"message\": \"æˆåŠŸæ›´æ–° 3 ä¸ªä»·æ ¼è¦†ç›–\"\r\n}\r\n```\r\n\r\n### 3.2 985Proxy APIé›†æˆ\r\n\r\n#### GET /api/v1/proxy985/business-list\r\n**æè¿°ï¼š** è·å–çƒ­é—¨ä¸šåŠ¡åœºæ™¯åˆ—è¡¨\r\n\r\n**å“åº”ç¤ºä¾‹ï¼š**\r\n```json\r\n{\r\n  \"success\": true,\r\n  \"data\": [\r\n    {\r\n      \"business_scenario\": \"ç”µå•†å¹³å°\",\r\n      \"description\": \"é€‚ç”¨äºç”µå•†ç½‘ç«™è®¿é—®\"\r\n    },\r\n    {\r\n      \"business_scenario\": \"ç¤¾äº¤åª’ä½“\",\r\n      \"description\": \"é€‚ç”¨äºç¤¾äº¤å¹³å°\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n#### GET /api/v1/proxy/static/inventory\r\n**æè¿°ï¼š** è·å–é™æ€IPåº“å­˜ï¼ˆå«ä¸šåŠ¡åœºæ™¯è¿‡æ»¤ï¼‰\r\n\r\n**è¯·æ±‚å‚æ•°ï¼š**\r\n```typescript\r\nquery: {\r\n  ipType?: 'shared' | 'premium';\r\n  duration?: number;\r\n  businessScenario?: string;  // æ–°å¢\r\n}\r\n```\r\n\r\n### 3.3 ç»Ÿè®¡æ•°æ®API\r\n\r\n#### GET /api/v1/stats/admin-pending-tasks\r\n**æè¿°ï¼š** è·å–ç®¡ç†å‘˜å¾…å¤„ç†äº‹é¡¹æ•°é‡\r\n\r\n**å“åº”ç¤ºä¾‹ï¼š**\r\n```json\r\n{\r\n  \"success\": true,\r\n  \"data\": {\r\n    \"pendingRecharges\": 5,    // å¾…å®¡æ ¸å……å€¼\r\n    \"abnormalOrders\": 2,       // å¼‚å¸¸è®¢å•\r\n    \"systemNotifications\": 3,  // ç³»ç»Ÿé€šçŸ¥\r\n    \"total\": 10                // æ€»è®¡\r\n  }\r\n}\r\n```\r\n\r\n---\r\n\r\n## 4. ç»„ä»¶è®¾è®¡\r\n\r\n### 4.1 è´¦æˆ·ä¸­å¿ƒé¡µé¢é‡æ„\r\n\r\n**ç»„ä»¶ç»“æ„ï¼š**\r\n```vue\r\n<template>\r\n  <div class=\"account-center\">\r\n    <!-- é¡µé¢å¤´éƒ¨ -->\r\n    <div class=\"page-header\">\r\n      <h2>è´¦æˆ·ä¸­å¿ƒ</h2>\r\n      <el-button type=\"primary\" @click=\"handleChangePassword\">\r\n        ä¿®æ”¹å¯†ç \r\n      </el-button>\r\n    </div>\r\n\r\n    <!-- ä¸»å†…å®¹åŒºï¼šå·¦å³å¸ƒå±€ -->\r\n    <el-row :gutter=\"20\" class=\"main-content\">\r\n      <!-- å·¦ä¾§ï¼šè´¦æˆ·ä¿¡æ¯ (60%) -->\r\n      <el-col :xs=\"24\" :sm=\"24\" :md=\"14\" :lg=\"14\">\r\n        <el-card class=\"info-card\">\r\n          <template #header>\r\n            <span>ğŸ“± ç™»å½•å¯†ç </span>\r\n          </template>\r\n          <div class=\"info-item\">\r\n            <span>å½“å‰å¯†ç å¼ºåº¦ï¼š</span>\r\n            <el-tag type=\"success\">å¼º</el-tag>\r\n          </div>\r\n          <div class=\"info-item\">\r\n            <span>æœ€åä¿®æ”¹æ—¶é—´ï¼š</span>\r\n            <span>{{ userInfo.passwordUpdatedAt }}</span>\r\n          </div>\r\n        </el-card>\r\n\r\n        <el-card class=\"info-card\">\r\n          <template #header>\r\n            <span>âœ‰ï¸ é‚®ç®±ç»‘å®š</span>\r\n          </template>\r\n          <!-- ... -->\r\n        </el-card>\r\n\r\n        <el-card class=\"info-card\">\r\n          <template #header>\r\n            <span>ğŸ”” é€šçŸ¥è®¾ç½®</span>\r\n          </template>\r\n          <!-- ... -->\r\n        </el-card>\r\n      </el-col>\r\n\r\n      <!-- å³ä¾§ï¼šå¿«æ·æ“ä½œå’Œå®¢æœ (40%) -->\r\n      <el-col :xs=\"24\" :sm=\"24\" :md=\"10\" :lg=\"10\">\r\n        <!-- å¿«æ·æ“ä½œå¡ç‰‡ -->\r\n        <el-card class=\"quick-actions-card\">\r\n          <template #header>\r\n            <span>ğŸš€ å¿«æ·æ“ä½œ</span>\r\n          </template>\r\n          <div class=\"action-list\">\r\n            <div class=\"action-item\" @click=\"navigate('/proxy/static/buy')\">\r\n              <el-icon><ShoppingCart /></el-icon>\r\n              <span>è®¢è´­é™æ€IP</span>\r\n            </div>\r\n            <!-- ... -->\r\n          </div>\r\n        </el-card>\r\n\r\n        <!-- è”ç³»å®¢æœå¡ç‰‡ -->\r\n        <el-card class=\"support-card\">\r\n          <template #header>\r\n            <span>ğŸ’¬ è”ç³»å®¢æœ</span>\r\n          </template>\r\n          <div class=\"support-info\">\r\n            <div class=\"support-item\">\r\n              <el-icon><Service /></el-icon>\r\n              <div>\r\n                <div class=\"label\">åœ¨çº¿å®¢æœ</div>\r\n                <div class=\"value\">9:00 - 22:00</div>\r\n              </div>\r\n            </div>\r\n            <!-- ... -->\r\n          </div>\r\n        </el-card>\r\n      </el-col>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n```\r\n\r\n**å“åº”å¼æ–­ç‚¹ï¼š**\r\n```scss\r\n// æ¡Œé¢ç«¯ (â‰¥768px)\r\n.main-content {\r\n  .el-col:first-child { width: 60%; }\r\n  .el-col:last-child { width: 40%; }\r\n}\r\n\r\n// ç§»åŠ¨ç«¯ (<768px)\r\n@media (max-width: 768px) {\r\n  .main-content {\r\n    flex-direction: column;\r\n    .el-col { width: 100%; }\r\n  }\r\n}\r\n```\r\n\r\n### 4.2 ä»ªè¡¨ç›˜å¡ç‰‡ä¿®å¤\r\n\r\n**é—®é¢˜è¯Šæ–­ï¼š**\r\n- å¡ç‰‡å®½åº¦è®¡ç®—é”™è¯¯å¯¼è‡´æœ€åä¸€ä¸ªå¡ç‰‡è¢«æˆªæ–­\r\n- `el-col` spanå€¼æ€»å’Œè¶…è¿‡24\r\n\r\n**ä¿®å¤æ–¹æ¡ˆï¼š**\r\n```vue\r\n<el-row :gutter=\"20\" class=\"stats-cards\">\r\n  <el-col :xs=\"12\" :sm=\"12\" :md=\"6\" :lg=\"6\" v-for=\"stat in stats\" :key=\"stat.label\">\r\n    <el-card class=\"stat-card\">\r\n      <div class=\"stat-content\">\r\n        <el-icon :class=\"`stat-icon ${stat.color}`\">\r\n          <component :is=\"stat.icon\" />\r\n        </el-icon>\r\n        <div class=\"stat-details\">\r\n          <div class=\"stat-value\">{{ stat.value }}</div>\r\n          <div class=\"stat-label\">{{ stat.label }}</div>\r\n        </div>\r\n      </div>\r\n    </el-card>\r\n  </el-col>\r\n</el-row>\r\n```\r\n\r\n**å“åº”å¼è§„åˆ™ï¼š**\r\n- æ¡Œé¢ç«¯ï¼ˆâ‰¥992pxï¼‰ï¼š4åˆ—æ˜¾ç¤ºï¼ˆ6 + 6 + 6 + 6 = 24ï¼‰\r\n- å¹³æ¿ç«¯ï¼ˆ768-991pxï¼‰ï¼š4åˆ—æ˜¾ç¤º\r\n- æ‰‹æœºç«¯ï¼ˆ<768pxï¼‰ï¼š2åˆ—æ˜¾ç¤ºï¼ˆ12 + 12 = 24ï¼‰\r\n\r\n### 4.3 ç”¨æˆ·ä»·æ ¼è¦†ç›–å¯¹è¯æ¡†\r\n\r\n**ç»„ä»¶é€»è¾‘ï¼š**\r\n```typescript\r\n// UserPriceOverrideModal.vue\r\ninterface IpPoolItem {\r\n  country: string;\r\n  city: string;\r\n  ipType: string;\r\n  originalPrice: number;\r\n  globalOverridePrice: number | null;\r\n  userOverridePrice: number | null;\r\n  currentPrice: number;\r\n  hasUserOverride: boolean;\r\n}\r\n\r\nconst loadUserIpPool = async (userId: number) => {\r\n  loading.value = true;\r\n  try {\r\n    const res = await getUserIpPool(userId);\r\n    ipPoolData.value = res.data.map(item => ({\r\n      ...item,\r\n      editablePrice: item.userOverridePrice ?? item.currentPrice\r\n    }));\r\n  } catch (error) {\r\n    ElMessage.error('åŠ è½½IPæ± æ•°æ®å¤±è´¥');\r\n  } finally {\r\n    loading.value = false;\r\n  }\r\n};\r\n\r\nconst handleSave = async () => {\r\n  const updates = ipPoolData.value\r\n    .filter(item => {\r\n      const hasChanged = item.editablePrice !== (item.userOverridePrice ?? item.currentPrice);\r\n      return hasChanged;\r\n    })\r\n    .map(item => ({\r\n      country: item.country,\r\n      city: item.city,\r\n      ipType: item.ipType,\r\n      overridePrice: item.editablePrice\r\n    }));\r\n\r\n  if (updates.length === 0) {\r\n    ElMessage.info('æ²¡æœ‰å˜æ›´éœ€è¦ä¿å­˜');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    await updateUserPriceOverrides(userId, { updates });\r\n    ElMessage.success('ä»·æ ¼è¦†ç›–æ›´æ–°æˆåŠŸ');\r\n    emit('success');\r\n    dialogVisible.value = false;\r\n  } catch (error) {\r\n    ElMessage.error('ä¿å­˜å¤±è´¥');\r\n  }\r\n};\r\n```\r\n\r\n---\r\n\r\n## 5. çŠ¶æ€ç®¡ç†\r\n\r\n### 5.1 å¾…å¤„ç†äº‹é¡¹çŠ¶æ€\r\n\r\n**Store: `adminStore`**\r\n```typescript\r\n// stores/admin.ts\r\ninterface PendingTasks {\r\n  pendingRecharges: number;\r\n  abnormalOrders: number;\r\n  systemNotifications: number;\r\n  total: number;\r\n}\r\n\r\nexport const useAdminStore = defineStore('admin', () => {\r\n  const pendingTasks = ref<PendingTasks>({\r\n    pendingRecharges: 0,\r\n    abnormalOrders: 0,\r\n    systemNotifications: 0,\r\n    total: 0\r\n  });\r\n\r\n  const fetchPendingTasks = async () => {\r\n    try {\r\n      const res = await getAdminPendingTasks();\r\n      pendingTasks.value = res.data;\r\n    } catch (error) {\r\n      console.error('Failed to fetch pending tasks:', error);\r\n    }\r\n  };\r\n\r\n  // å®šæ—¶åˆ·æ–°\r\n  let refreshInterval: number | null = null;\r\n  const startAutoRefresh = () => {\r\n    fetchPendingTasks(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡\r\n    refreshInterval = setInterval(fetchPendingTasks, 60000); // æ¯åˆ†é’Ÿåˆ·æ–°\r\n  };\r\n\r\n  const stopAutoRefresh = () => {\r\n    if (refreshInterval) {\r\n      clearInterval(refreshInterval);\r\n      refreshInterval = null;\r\n    }\r\n  };\r\n\r\n  return {\r\n    pendingTasks,\r\n    fetchPendingTasks,\r\n    startAutoRefresh,\r\n    stopAutoRefresh\r\n  };\r\n});\r\n```\r\n\r\n**ä½¿ç”¨ç¤ºä¾‹ï¼š**\r\n```vue\r\n<script setup lang=\"ts\">\r\nimport { useAdminStore } from '@/stores/admin';\r\n\r\nconst adminStore = useAdminStore();\r\n\r\nonMounted(() => {\r\n  adminStore.startAutoRefresh();\r\n});\r\n\r\nonUnmounted(() => {\r\n  adminStore.stopAutoRefresh();\r\n});\r\n</script>\r\n\r\n<template>\r\n  <el-badge :value=\"adminStore.pendingTasks.total\" :hidden=\"adminStore.pendingTasks.total === 0\">\r\n    <el-button>å¾…å¤„ç†äº‹é¡¹</el-button>\r\n  </el-badge>\r\n</template>\r\n```\r\n\r\n---\r\n\r\n## 6. æ ·å¼è§„èŒƒ\r\n\r\n### 6.1 å“åº”å¼æ–­ç‚¹\r\n```scss\r\n$breakpoints: (\r\n  'xs': 0,      // è¶…å°å±å¹• (æ‰‹æœº)\r\n  'sm': 576px,  // å°å±å¹• (æ‰‹æœºæ¨ªå±)\r\n  'md': 768px,  // ä¸­ç­‰å±å¹• (å¹³æ¿)\r\n  'lg': 992px,  // å¤§å±å¹• (æ¡Œé¢)\r\n  'xl': 1200px, // è¶…å¤§å±å¹• (å¤§æ¡Œé¢)\r\n);\r\n\r\n@mixin responsive($breakpoint) {\r\n  @media (min-width: map-get($breakpoints, $breakpoint)) {\r\n    @content;\r\n  }\r\n}\r\n```\r\n\r\n### 6.2 ç§»åŠ¨ç«¯é€‚é…è§„èŒƒ\r\n```scss\r\n// æœ€å°ç‚¹å‡»åŒºåŸŸ\r\n.btn-mobile {\r\n  min-height: 44px;\r\n  min-width: 44px;\r\n}\r\n\r\n// æ–‡å­—å¤§å°\r\n.text-mobile {\r\n  font-size: 14px;\r\n  line-height: 1.6;\r\n}\r\n\r\n// é—´è·\r\n.spacing-mobile {\r\n  padding: 12px;\r\n  margin: 8px 0;\r\n}\r\n\r\n// è¡¨æ ¼æ¨ªå‘æ»šåŠ¨\r\n.table-wrapper {\r\n  overflow-x: auto;\r\n  -webkit-overflow-scrolling: touch;\r\n}\r\n```\r\n\r\n---\r\n\r\n## 7. é”™è¯¯å¤„ç†\r\n\r\n### 7.1 APIé”™è¯¯å¤„ç†\r\n```typescript\r\n// utils/request.ts\r\nservice.interceptors.response.use(\r\n  (response) => response.data,\r\n  (error) => {\r\n    if (error.response?.status === 400) {\r\n      ElMessage.error('è¯·æ±‚å‚æ•°é”™è¯¯');\r\n    } else if (error.response?.status === 401) {\r\n      ElMessage.error('æœªæˆæƒï¼Œè¯·é‡æ–°ç™»å½•');\r\n      router.push('/login');\r\n    } else if (error.response?.status === 404) {\r\n      ElMessage.error('è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨');\r\n    } else if (error.response?.status === 500) {\r\n      ElMessage.error('æœåŠ¡å™¨å†…éƒ¨é”™è¯¯');\r\n    } else {\r\n      ElMessage.error(error.message || 'è¯·æ±‚å¤±è´¥');\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n```\r\n\r\n### 7.2 ç»„ä»¶é”™è¯¯è¾¹ç•Œ\r\n```vue\r\n<script setup lang=\"ts\">\r\nimport { onErrorCaptured } from 'vue';\r\n\r\nonErrorCaptured((err, instance, info) => {\r\n  console.error('Component error:', err, info);\r\n  ElMessage.error('é¡µé¢æ¸²æŸ“å‡ºé”™ï¼Œè¯·åˆ·æ–°é‡è¯•');\r\n  return false; // é˜»æ­¢é”™è¯¯ç»§ç»­ä¼ æ’­\r\n});\r\n</script>\r\n```\r\n\r\n---\r\n\r\n## 8. æµ‹è¯•ç­–ç•¥\r\n\r\n### 8.1 å•å…ƒæµ‹è¯•\r\n```typescript\r\n// PricingService.spec.ts\r\ndescribe('PricingService', () => {\r\n  describe('getUserIpPoolForPriceOverride', () => {\r\n    it('should return IP pool with user overrides', async () => {\r\n      const result = await pricingService.getUserIpPoolForPriceOverride(1);\r\n      expect(result).toHaveProperty('data');\r\n      expect(result.data).toBeArray();\r\n    });\r\n  });\r\n\r\n  describe('batchUpdateUserPriceOverrides', () => {\r\n    it('should update multiple price overrides', async () => {\r\n      const updates = [\r\n        { country: 'ç¾å›½', city: 'æ´›æ‰çŸ¶', ipType: 'shared', overridePrice: 4.99 }\r\n      ];\r\n      const result = await pricingService.batchUpdateUserPriceOverrides(1, updates);\r\n      expect(result.success).toBe(true);\r\n    });\r\n  });\r\n});\r\n```\r\n\r\n### 8.2 é›†æˆæµ‹è¯•\r\n```typescript\r\n// api.spec.ts\r\ndescribe('API Integration', () => {\r\n  it('should connect to 985Proxy API successfully', async () => {\r\n    const res = await request(app.getHttpServer())\r\n      .get('/proxy985/business-list')\r\n      .set('Authorization', `Bearer ${token}`)\r\n      .expect(200);\r\n\r\n    expect(res.body.success).toBe(true);\r\n    expect(res.body.data).toBeArray();\r\n  });\r\n});\r\n```\r\n\r\n### 8.3 E2Eæµ‹è¯•\r\n```typescript\r\n// account-center.e2e.ts\r\ndescribe('Account Center Page', () => {\r\n  it('should display in 2-column layout on desktop', async () => {\r\n    await page.setViewport({ width: 1920, height: 1080 });\r\n    await page.goto('/account/center');\r\n    \r\n    const leftCol = await page.$('.el-col:first-child');\r\n    const rightCol = await page.$('.el-col:last-child');\r\n    \r\n    expect(leftCol).toBeTruthy();\r\n    expect(rightCol).toBeTruthy();\r\n  });\r\n\r\n  it('should stack vertically on mobile', async () => {\r\n    await page.setViewport({ width: 375, height: 667 });\r\n    await page.goto('/account/center');\r\n    \r\n    // éªŒè¯å‚ç›´å †å å¸ƒå±€\r\n  });\r\n});\r\n```\r\n\r\n---\r\n\r\n## 9. æ€§èƒ½ä¼˜åŒ–\r\n\r\n### 9.1 å‰ç«¯ä¼˜åŒ–\r\n```typescript\r\n// æ‡’åŠ è½½ç»„ä»¶\r\nconst UserPriceOverrideModal = defineAsyncComponent(() =>\r\n  import('@/components/UserPriceOverrideModal.vue')\r\n);\r\n\r\n// é˜²æŠ–æœç´¢\r\nconst debouncedSearch = debounce((keyword: string) => {\r\n  fetchData(keyword);\r\n}, 300);\r\n\r\n// è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§æ•°æ®åˆ—è¡¨ï¼‰\r\n<el-table-v2\r\n  :columns=\"columns\"\r\n  :data=\"largeDataset\"\r\n  :width=\"700\"\r\n  :height=\"400\"\r\n  fixed\r\n/>\r\n```\r\n\r\n### 9.2 åç«¯ä¼˜åŒ–\r\n```typescript\r\n// ç¼“å­˜çƒ­é—¨ä¸šåŠ¡åœºæ™¯\r\n@Cacheable('business-scenarios', { ttl: 3600 })\r\nasync getBusinessList() {\r\n  return this.proxy985Service.getBusinessList();\r\n}\r\n\r\n// æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–\r\nasync getUserIpPoolForPriceOverride(userId: number) {\r\n  return this.priceOverrideRepository\r\n    .createQueryBuilder('po')\r\n    .select([\r\n      'po.country',\r\n      'po.city',\r\n      'po.ipType',\r\n      'po.overridePrice as userOverridePrice'\r\n    ])\r\n    .where('po.userId = :userId', { userId })\r\n    .orWhere('po.userId IS NULL')\r\n    .orderBy('po.country', 'ASC')\r\n    .addOrderBy('po.city', 'ASC')\r\n    .getMany();\r\n}\r\n```\r\n\r\n---\r\n\r\n## 10. éƒ¨ç½²è€ƒè™‘\r\n\r\n### 10.1 ç¯å¢ƒå˜é‡\r\n```env\r\n# 985Proxy API\r\nPROXY_985_API_KEY=your_api_key\r\nPROXY_985_ZONE=your_zone\r\n\r\n# æ•°æ®åº“\r\nDATABASE_HOST=localhost\r\nDATABASE_PORT=5432\r\nDATABASE_NAME=proxyhub\r\n\r\n# Redis\r\nREDIS_HOST=localhost\r\nREDIS_PORT=6379\r\n```\r\n\r\n### 10.2 Dockeré…ç½®\r\n```yaml\r\n# docker-compose.yml\r\nservices:\r\n  backend:\r\n    environment:\r\n      - PROXY_985_API_KEY=${PROXY_985_API_KEY}\r\n      - PROXY_985_ZONE=${PROXY_985_ZONE}\r\n    restart: unless-stopped\r\n\r\n  frontend:\r\n    environment:\r\n      - VITE_API_BASE_URL=/api/v1\r\n    restart: unless-stopped\r\n```\r\n\r\n---\r\n\r\n## 11. äº¤ä»˜æ¸…å•\r\n\r\n### 11.1 ä»£ç äº¤ä»˜\r\n- âœ… å‰ç«¯ç»„ä»¶ï¼ˆVueæ–‡ä»¶ï¼‰\r\n- âœ… åç«¯æœåŠ¡ï¼ˆTypeScriptæ–‡ä»¶ï¼‰\r\n- âœ… APIæ¥å£æ–‡æ¡£\r\n- âœ… æ•°æ®åº“è¿ç§»è„šæœ¬\r\n\r\n### 11.2 æ–‡æ¡£äº¤ä»˜\r\n- âœ… æŠ€æœ¯è®¾è®¡æ–‡æ¡£ï¼ˆæœ¬æ–‡æ¡£ï¼‰\r\n- âœ… APIæ¥å£æ–‡æ¡£\r\n- âœ… éƒ¨ç½²æ–‡æ¡£\r\n- âœ… æµ‹è¯•æŠ¥å‘Š\r\n\r\n### 11.3 æµ‹è¯•äº¤ä»˜\r\n- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%\r\n- âœ… é›†æˆæµ‹è¯•é€šè¿‡\r\n- âœ… E2Eæµ‹è¯•é€šè¿‡\r\n- âœ… ç”¨æˆ·éªŒæ”¶æµ‹è¯•é€šè¿‡\r\n\r\n---\r\n\r\n**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0.0  \r\n**åˆ›å»ºæ—¥æœŸï¼š** 2025-11-10  \r\n**æœ€åæ›´æ–°ï¼š** 2025-11-10\r\n\r\n",
  "fileStats": {
    "size": 20568,
    "lines": 755,
    "lastModified": "2025-11-10T06:47:02.849Z"
  },
  "comments": []
}